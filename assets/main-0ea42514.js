var ns=Object.defineProperty;var as=(l,o,e)=>o in l?ns(l,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[o]=e;var v=(l,o,e)=>(as(l,typeof o!="symbol"?o+"":o,e),e),lt=(l,o,e)=>{if(!o.has(l))throw TypeError("Cannot "+e)};var s=(l,o,e)=>(lt(l,o,"read from private field"),e?e.call(l):o.get(l)),a=(l,o,e)=>{if(o.has(l))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(l):o.set(l,e)},h=(l,o,e,t)=>(lt(l,o,"write to private field"),t?t.call(l,e):o.set(l,e),e);var d=(l,o,e)=>(lt(l,o,"access private method"),e);import{H as A,D as ls,W as ft,b as cs,w as vt,d as De,a as xt}from"./index-56367448.js";class wt extends A{constructor(){super(),this.dispatcher=new ls}control(){return""}render(){const o=this.args.title||"Title";return this.node("div",[this.node("label",[o,":"],{class:{value:"text-xs font-semibold text-zinc-400 text-opacity-80",keys:[]}},["{__CODE__0}"],""),this.node("div",[this.control(),this.args.child||""],{class:{value:"flex flex-row w-full",keys:[]}},["{__CODE__1}","{__CODE__2}"],"")],{class:{value:"flex flex-col w-full",keys:[]}},[],"")}getProperty(o){if(this.args.property)return this.args.property[o]}getValue(){}setValue(o){}onUpdate(){}destroy(){this.dispatcher.clearAll(),super.destroy()}}class St extends wt{constructor(){super()}control(){const o=this.args.type||this.getProperty("type")||"text";return this.node("input",[],{id:{value:"textbox",keys:[]},type:{value:o,keys:[]},class:{value:"primary-input w-full",keys:[]},oninput:{value:this.onUpdate,keys:[]}},[],"")}onUpdate(){this.dispatcher.emit("onUpdated",this.element.textbox.value)}getValue(){return this.element.textbox.value}setValue(o){this.element.textbox.value=o}}var b;class us{constructor(){a(this,b,new Map)}on(o,e){s(this,b).has(o)||s(this,b).set(o,[]),s(this,b).get(o).push(e)}off(o,e){s(this,b).has(o)&&s(this,b).set(o,s(this,b).get(o).filter(t=>t!==e))}emit(o,...e){s(this,b).has(o)&&s(this,b).get(o).forEach(t=>t(...e))}once(o,e){const t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}clear(o){s(this,b).has(o)&&(s(this,b).delete(o),console.warn(`Event ${o} cleared`))}clearAll(){s(this,b).clear(),console.warn("Event handler cleared")}}b=new WeakMap;var we,Se,be,Ne;class q{constructor({uuid:o=crypto.randomUUID(),outer:e=null,name:t=null}={}){a(this,we,null);a(this,Se,null);a(this,be,null);a(this,Ne,new us);h(this,we,o),h(this,Se,e),h(this,be,t)}main(){}destroy(){s(this,Ne).clearAll()}get dispatcher(){return s(this,Ne)}get uuid(){return s(this,we)}get name(){return s(this,be)}get outer(){return s(this,Se)}get meta(){return this.constructor.meta}static getMeta(){return this.meta}}we=new WeakMap,Se=new WeakMap,be=new WeakMap,Ne=new WeakMap,v(q,"meta",{className:"IObject.IObject",displayName:"Object",description:"Object"});var N,D,Ee,ie;const F=class F extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null,name:r=null,type:i=null,isRuntime:n=!1}={}){super({uuid:e,outer:t,name:r});a(this,N,[]);a(this,D,null);a(this,Ee,!1);a(this,ie,null);h(this,D,i),h(this,N,[]),h(this,Ee,n),this.subType=-1,this.validSubTypes=new Set([]),this.maxLinks=1}get links(){return s(this,N)}get type(){return s(this,D)}get isRuntime(){return s(this,Ee)}getValue(){if(s(this,D)==F.TYPES.INPUT){const e=s(this,N)[0];if(!e)return null;const t=e.getNode();return t?(t.meta.canCache||t.execute(),e.getValue()):null}else return s(this,ie)}getValues(){if(s(this,D)==F.TYPES.INPUT){const e=[];return s(this,N).forEach(t=>{if(t){const r=t.getValue();if(!r)return;e.push(r)}}),e}else return[s(this,ie)]}setValue(e){if(s(this,D)==F.TYPES.INPUT){console.error("Cannot set input value");return}h(this,ie,e)}getNode(){return this.outer}isAnyLinked(){return s(this,N).length>0}isLinked(e=0){return!!this.getLink(e)}getLink(e){return s(this,N)[e]}getLinkedNode(e){const t=this.getLink(e);return t?t.outer:null}canLinkTo(e){if(!e||!e.type||!e.outer||e.type==s(this,D)){console.error("Invalid socket, type, or same socket type");return}if(e.outer==this.outer){console.error("Source and target sockets are the same");return}if(s(this,D)==F.TYPES.INPUT&&!this.validSubTypes.has(e.subType)){console.error("Invalid sub-socket type");return}if(s(this,N).length>=this.maxLinks){console.error("Link limit failed");return}return!0}link(e){s(this,N).push(e)}unlink(e){h(this,N,s(this,N).filter(t=>t!=e))}clear(){h(this,N,[])}export(){let e=[];return this.type!==F.TYPES.OUTPUT||this.links.forEach(t=>{!t||!t.outer||!this.outer||e.push({sourceNode:this.outer.uuid,sourceSocket:this.uuid,targetNode:t.outer.uuid,targetSocket:t.uuid})}),e}};N=new WeakMap,D=new WeakMap,Ee=new WeakMap,ie=new WeakMap,v(F,"meta",{className:"IObject.Socket",displayName:"Socket",displayColor:"gray"}),v(F,"TYPES",{INPUT:1,OUTPUT:2});let f=F;var ne,ee,ae;class bt extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null,name:r=null,type:i=null,value:n=null,custom:c=null}={}){super({uuid:e,outer:t,name:r});a(this,ne,null);a(this,ee,null);a(this,ae,null);h(this,ne,i),h(this,ee,n),h(this,ae,c)}get value(){return s(this,ee)}set value(e){h(this,ee,e)}get type(){return s(this,ne)}get custom(){return s(this,ae)}export(){return{name:this.name,type:s(this,ne),value:s(this,ee),custom:s(this,ae)}}}ne=new WeakMap,ee=new WeakMap,ae=new WeakMap,v(bt,"meta",{className:"IObject.IProperty",displayName:"Data"});const R={STRING:"STRING",BOOLEAN:"BOOLEAN",INT:"INT",FLOAT:"FLOAT",WILDCARD:"WILDCARD"},ct={OBJECT:"OBJECT"},kt={FUNCTION:"FUNCTION",EVENT:"EVENT"};var T;class ot extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null,name:r="Property Manager"}={}){super({uuid:e,outer:t,name:r});a(this,T,new Map)}main(e={}){try{for(const t in e){const r=e[t],i=r.type,n=r.name,c=r.value,u=r.custom;this.addProperty(t,n,i,c,u)}}catch(t){console.error(t)}}get properties(){return s(this,T)}addProperty(e,t,r,i=null,n={}){try{const c=e||crypto.randomUUID();if(!t)throw new Error("PropertyManager: Property name is required");if(s(this,T).has(t))throw new Error(`PropertyManager: Property "${t}" already exists`);const u=R[r]||ct[r];if(!u)throw new Error(`PropertyManager: Invalid type "${r}"`);const p=new bt({uuid:c,outer:this,name:t,type:u,value:i,custom:n});s(this,T).set(c,p),this.dispatcher.emit("propertyAdded",p)}catch(c){console.error(c)}}removeProperty(e){return s(this,T).delete(e)?(this.dispatcher.emit("propertyRemoved",e),!0):!1}getProperty(e){try{if(!s(this,T).has(e))throw new Error(`PropertyManager: Property "${e}" does not exist`);return s(this,T).get(e)}catch(t){console.error(t)}}setProperty(e,t){try{if(!s(this,T).has(e))throw new Error(`PropertyManager: Property "${e}" does not exist`);const r=this.getProperty(e);r.value=t}catch(r){console.error(r)}}export(){const e=s(this,T),t={};for(const[r,i]of e){const n=i.export();n&&(t[r]=n)}return t}}T=new WeakMap,v(ot,"meta",{className:"IObject.PropertyManager",displayName:"Property Manager"});class Nt extends f{constructor({uuid:o=crypto.randomUUID(),outer:e=null,name:t="float",type:r=null,isRuntime:i=!1}){super({uuid:o,outer:e,name:t,type:r,isRuntime:i}),this.subType=R.FLOAT,this.validSubTypes=new Set([R.INT,R.FLOAT]),this.maxLinks=r==f.TYPES.OUTPUT?100:1}}v(Nt,"meta",{className:"ISocket.FloatSocket",displayName:"Float",displayColor:"#059669"});class ge extends f{constructor({uuid:o=crypto.randomUUID(),outer:e=null,name:t="string",type:r=null,isRuntime:i=!1}){super({uuid:o,outer:e,name:t,type:r,isRuntime:i}),this.subType=R.STRING,this.validSubTypes=new Set([R.STRING]),this.maxLinks=r==f.TYPES.OUTPUT?100:1}}v(ge,"meta",{className:"ISocket.StringSocket",displayName:"String",displayColor:"#d946ef"});var te,P,E;class ke extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null}={}){super({uuid:e,outer:t});a(this,te,null);a(this,P,{});a(this,E,{});this.custom={},this.isEntry=!1,h(this,te,new ot({outer:this}))}get inputs(){return s(this,P)}get outputs(){return s(this,E)}get propertyManager(){return s(this,te)}main({properties:e={},custom:t={},inputs:r={},outputs:i={}}={}){try{t&&(this.custom=t);for(const n in r){const c=r[n],u=ge;this.addInput(n,c.name,u,!0)}for(const n in i){const c=i[n],u=ge;this.addOutput(n,c.name,u,!0)}for(const n in e){const c=e[n];s(this,te).setProperty(n,c.value)}return!0}catch(n){console.error(n)}}addInput(e,t,r,i=!1){if(!r||s(this,P)[e])return null;const n=new r({uuid:e,outer:this,name:t,type:f.TYPES.INPUT,isRuntime:i});return s(this,P)[e]=n,n}removeInput(e){if(s(this,P)[e].isRuntime)return delete s(this,P)[e],!0;console.error("Cannot remove static socket")}addOutput(e,t,r,i=!1){if(!r){console.error("Invalid socket class");return}if(s(this,E)[e]){console.error("Socket already exists");return}const n=new r({uuid:e,outer:this,name:t,type:f.TYPES.OUTPUT,isRuntime:i});return s(this,E)[e]=n,n}removeOutput(e){if(s(this,E)[e].isRuntime)return delete s(this,E)[e],!0;console.error("Cannot remove static socket")}getInput(e){return s(this,P)[e]}getOutput(e){return s(this,E)[e]}getSocket(e){return this.getInput(e)||this.getOutput(e)}execute(){}executeLinkedNode(e,t=0){const r=this.getSocket(e);if(r&&r.isLinked(t)){const i=r.getLinkedNode(t);i&&i.execute()}}customExport(){return null}export(){const e={class:this.meta.className,properties:s(this,te).export(),custom:this.custom||{},inputs:{},outputs:{}};for(const r in s(this,P)){const i=s(this,P)[r];i.isRuntime&&(e.inputs[r]={name:i.name||"in",type:i.subType})}for(const r in s(this,E)){const i=s(this,E)[r];i.isRuntime&&(e.outputs[r]={name:i.name||"out",type:i.subType})}let t=[];for(const r in s(this,E)){const i=s(this,E)[r];t=t.concat(i.export())}return{data:e,links:t}}}te=new WeakMap,P=new WeakMap,E=new WeakMap,v(ke,"meta",{className:"IObject.INode",displayName:"Node",canCache:!0});const ve=new Map,it={register:function(l,o){ve.set(l,o)},registerMany:function(l={}){for(const o in l)this.register(o,l[o])},unregister:function(l){return ve.delete(l)},get:function(l){return ve.get(l)},getAll:function(){return ve.entries()},isRegistered:function(l){return ve.has(l)}};var G,se,re,Ge,Me;class Et extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null,name:r="Graph"}={}){super({uuid:e,outer:t,name:r});a(this,G,new Map);a(this,se,null);a(this,re,[]);a(this,Ge,null);a(this,Me,null);this.custom={},h(this,se,new ot({outer:this}))}get nodes(){return s(this,G)}get propertyManager(){return s(this,se)}get links(){return s(this,re)}get inputs(){return s(this,Ge)}get outputs(){return s(this,Me)}main({properties:e={},nodes:t={},links:r=[],custom:i={},inputs:n={},outputs:c={}}={}){this.custom=i||{},this.custom.name=i.name||this.name,s(this,se).main(e||{});for(const u in t){const p=t[u];this.addNode(u,p)}for(const u of r){const p=this.getNode(u.sourceNode),g=this.getNode(u.targetNode);this.linkSocketsByUUID(p,u.sourceSocket,g,u.targetSocket)}return!0}addOutput(e,t,r){const i=e||crypto.randomUUID();if(!this.outputs[i])return this.outputs[i]={name:t,type:r},i}getOutputs(){return this.outputs}addNode(e,t={class:null,properties:{},custom:{}}){try{const r=e||crypto.randomUUID();if(s(this,G).has(r))throw new Error(`Graph: Node "${r}" already exists`);if(!t||!t.class)throw new Error("Graph: Node class is required");const i=it.get(t.class);if(!i)throw new Error(`Graph: Node class "${t.class}" is not registered`);const n=new i({uuid:r,outer:this});return n.main({properties:t.properties,custom:t.custom||{},inputs:t.inputs||{},outputs:t.outputs||{}}),s(this,G).set(r,n),this.dispatcher.emit("nodeAdded",n),n}catch(r){console.error(r)}}getNode(e){return s(this,G).get(e)}removeNodeByUUID(e){const t=this.getNode(e);return this.removeNode(t)}removeNode(e){if(!e)return null;const t=e.inputs;for(const i in t){const n=t[i];this.clearAllSocketLinks(n)}const r=e.outputs;for(const i in r){const n=r[i];this.clearAllSocketLinks(n)}return s(this,G).delete(e.uuid),!0}clearAllSocketLinksByUUID(e,t){const r=this.getNode(e);if(!r)return;const i=r.getSocket(t);if(i)return this.clearAllSocketLinks(i)}clearAllSocketLinks(e){if(!e)return;const t=e.uuid,r=e.outer.uuid;return e.links.forEach(i=>{const n=i.uuid,c=i.outer.uuid;i.unlink(e),h(this,re,s(this,re).filter(u=>!(u.sourceNode==c&&u.sourceSocket==n&&u.targetNode==r&&u.targetSocket==t)))}),e.clear(),!0}linkNodesSocketsByUUID(e,t,r,i){const n=this.getNode(e),c=this.getNode(r);this.linkSocketsByUUID(n,t,c,i)}linkSocketsByUUID(e,t,r,i){if(!e||!r){console.error("Invalid target or source node");return}const n=e.getOutput(t),c=r.getInput(i);return this.linkSockets(n,c)}linkSockets(e,t){if(e.type!==f.TYPES.OUTPUT||t.type!==f.TYPES.INPUT){console.error("Source should be an output socket and target should be an input socket");return}if(!e||!t){console.error("Invalid target or source socket");return}if(e==t){console.error("Source and target socket are the same");return}if(!e.canLinkTo(t)||!t.canLinkTo(e)){console.error("Cannot connect socket");return}e.link(t),t.link(e);const r={sourceNode:e.outer.uuid,sourceSocket:e.uuid,targetNode:t.outer.uuid,targetSocket:t.uuid};return s(this,re).push(r),this.dispatcher.emit("socketsLinked",r),console.warn(`Sockets Linked ${e.uuid} <--> ${t.uuid}`),!0}executeNode(e){const t=this.getNode(e);t&&t.execute()}getEntryNode(){let e=null;return s(this,G).forEach(t=>{t.isEntry&&(e=t)}),e}customExport(){return{}}export(){let e=!0;const t={entry:null,nodes:{},links:[],properties:s(this,se).export(),custom:this.custom};for(const[r,i]of s(this,G)){const{data:n,links:c}=i.export();if(t.nodes[r]=n,t.links.push(...c),i.isEntry){if(t.entry){e=!1;break}t.entry=r}}if(!e){console.error("Multiple entry found");return}return t}}G=new WeakMap,se=new WeakMap,re=new WeakMap,Ge=new WeakMap,Me=new WeakMap,v(Et,"meta",{className:"IObject.IGraph",displayName:"Graph"});var U,oe;class It extends q{constructor({uuid:e=crypto.randomUUID(),outer:t=null,name:r="Graph Set"}={}){super({uuid:e,outer:t,name:r});a(this,U,new Map);a(this,oe,null);this.custom={},h(this,oe,new ot({outer:this,properties:{}}))}get graphs(){return s(this,U)}get propertyManager(){return s(this,oe)}main({properties:e={},graphs:t={},custom:r={}}={}){try{this.custom=r||{},this.custom.name=r.name||this.name,s(this,oe).main(e);for(const i in t){const n=t[i];this.addGraph(i,n)}return!0}catch(i){console.error(i)}}getGraph(e){try{if(!s(this,U).has(e))throw new Error(`IGraphSet: Graph "${e}" does not exist`);return s(this,U).get(e)}catch(t){console.error(t)}}addGraph(e,t={nodes:{},links:[],properties:{},custom:{},inputs:{},outputs:{}}){try{const r=e||crypto.randomUUID();if(!t)throw new Error("IGraphSet: Graph data is required");if(s(this,U).has(r))throw new Error(`IGraphSet: Graph "${r}" already exists`);const i=new Et({uuid:r,outer:this});return i.main({nodes:t.nodes,links:t.links,properties:t.properties,custom:t.custom,inputs:t.inputs,outputs:t.outputs}),s(this,U).set(r,i),this.dispatcher.emit("graphAdded",i),i}catch(r){console.error(r)}}removeGraph(e){const t=s(this,U).get(e);return t?(t.destroy(),s(this,U).delete(e),this.dispatcher.emit("graphRemoved"),!0):!1}export(){const e=s(this,U),t={graphs:{},properties:{},custom:this.custom};for(const[r,i]of e){const n=i.export();n&&(t.graphs[r]=n)}return t.properties=s(this,oe).export(),{[this.uuid]:t}}destroy(){super.destroy()}}U=new WeakMap,oe=new WeakMap,v(It,"meta",{className:"IObject.GraphSet",displayName:"Graph Set",description:"A collection of graphs"});class Tt extends ke{constructor({uuid:o,outer:e}){super({uuid:o,outer:e})}main(o){this.addOutput("value0","value",Nt),this.propertyManager.addProperty("value0","value",R.FLOAT,0),super.main(o)}execute(){let o=this.propertyManager.getProperty("value").value;isNaN(o)?o=null:o=parseFloat(o),this.getOutput("value0").setValue(o)}}v(Tt,"meta",{className:"INode.Value.MakeFloat",displayName:"Make Float",canCache:!1});class Pt extends ke{constructor({uuid:o,outer:e}){super({uuid:o,outer:e})}main(o){this.addOutput("value0","value",ge),this.propertyManager.addProperty("value0","value",R.STRING,""),super.main(o)}execute(){const e=this.propertyManager.getProperty("value0").value;this.getOutput("value0").setValue(e)}}v(Pt,"meta",{className:"INode.Value.MakeString",displayName:"Make String",canCache:!1});it.registerMany({"INode.Value.MakeFloat":Tt,"INode.Value.MakeString":Pt});class gt extends f{constructor({uuid:o=crypto.randomUUID(),outer:e=null,name:t="object",type:r=null,isRuntime:i=!1}){super({uuid:o,outer:e,name:t,type:r,isRuntime:i}),this.subType=ct.OBJECT,this.validSubTypes=new Set([ct.OBJECT]),this.maxLinks=r==f.TYPES.OUTPUT?100:1}}v(gt,"meta",{className:"ISocket.Object",displayName:"Object",displayColor:"#14b8a6"});class xe extends f{constructor({uuid:o=crypto.randomUUID(),outer:e=null,name:t="exec",type:r=null,isRuntime:i=!1}){super({uuid:o,outer:e,name:t,type:r,isRuntime:i}),this.subType=kt.FUNCTION,this.validSubTypes=new Set([kt.FUNCTION]),this.maxLinks=r==f.TYPES.OUTPUT?1:100}}v(xe,"meta",{className:"ISocket.ExecutionSocket",displayName:"Exec",displayColor:"#94a3b8"});class Ut extends ke{constructor({uuid:o,outer:e}){super({uuid:o,outer:e}),this.isEntry=!0}main(o){this.addOutput("out0","out",xe),this.addOutput("args0","args?",gt),super.main(o)}execute(){console.log("begin"),this.executeLinkedNode("out0",0)}}v(Ut,"meta",{className:"INode.Event.Begin",displayName:"Begin",canCache:!0});class Lt extends ke{constructor({uuid:o,outer:e}){super({uuid:o,outer:e})}main(o){this.addInput("in0","in",xe),this.addInput("value1","value",ge),this.addOutput("out0","out",xe),super.main(o)}execute(){let o=this.getInput("value1").getValue();console.log("log",o),this.executeLinkedNode("out0",0)}}v(Lt,"meta",{className:"INode.Event.Log",displayName:"Log",canCache:!0});class Ot extends ke{constructor({uuid:o,outer:e}){super({uuid:o,outer:e})}main(o){this.addInput("in0","in",xe),this.addInput("args0","args?",gt),super.main(o)}execute(){console.log("end")}}v(Ot,"meta",{className:"INode.Event.Return",displayName:"Return",canCache:!0});it.registerMany({"INode.Event.Begin":Ut,"INode.Event.Log":Lt,"INode.Event.Return":Ot});var $;class Ct extends q{constructor({uuid:e=crypto.randomUUID()}={}){super({uuid:e});a(this,$,new Map)}get graphSets(){return s(this,$)}addGraphSet(e,t={properties:{},graphs:{},custom:{}}){try{const r=e||crypto.randomUUID();if(s(this,$).has(r))throw new Error(`Graph set "${r}" already exists`);const i=new It({uuid:r,outer:this});if(!i.main({properties:t.properties||{},graphs:t.graphs||{}}))throw new Error(`Graph set "${r}" could not be created`);return s(this,$).set(r,i),this.dispatcher.emit("graphSetAdded",i),i}catch(r){console.error(r)}}getGraphSet(e){return s(this,$).get(e)}clearGraphSets(){s(this,$).clear()}destroy(){super.destroy()}}$=new WeakMap,v(Ct,"meta",{className:"IObject.IEngine",displayName:"Engine"});const k={zoom:1,zoomMax:2,zoomMin:.3,size:{width:1250,height:850}};function nt(l){let o=l;for(;o;){if(o instanceof ft)return o;o=o.parent}}class hs extends A{constructor(){super(),this.staticFieldCreated=!1,this.staticFields={},this.items=[],this.workplace=null}main(o){o&&o.auto&&this.createCategory(),this.workplace=nt(this)}render(){return this.node("div",[this.node("div",["{staticmenu}"],{},["{staticmenu}"],"")],{class:{value:"select-none",keys:[]}},[],"")}createField(o="",e){const t=o.split(".");t.pop();const i=e.getMeta().displayName;this.items.push(i);for(let n=0;n<t.length;n++){const c=t[n],u=t[n-1],p=n==t.length-1;if(!this.staticFields[c]){const g=this.node("details",[this.node("summary",[c],{class:{value:"text-sm font-semibold",keys:[]}},["{__CODE__0}"],""),this.node("div",[],{class:{value:"pl-4 flex flex-col space-y-1",keys:[]}},[],"")],{class:{value:"space-y-1",keys:[]},open:{value:"",keys:[]}},[],"");this.staticFields[c]=g,u&&this.staticFields[u]?this.staticFields[u].children[1].appendChild(g):this.set("{staticmenu}++",g)}p&&this.staticFields[c].children[1].appendChild(this.node("button",[i],{onclick:{value:()=>{this.addNode(o)},keys:[]},class:{value:"text-left italic hover:font-semibold hover:underline",keys:[]}},["{__CODE__1}"],""))}}addNode(o){this.workplace&&this.workplace.dispatcher.emit("addNode",o)}createCategory(){if(!this.staticFieldCreated){const o=it.getAll();for(const[e,t]of o)this.createField(e,t);this.staticFieldCreated=!0}}}var M;class Dt extends A{constructor(){super();a(this,M,null);this.control=wt,this.controlProperties={}}get iproperty(){return s(this,M)}main(){if(!s(this,M))return;const{control:e}=this.child;e.setValue(s(this,M).value),e.dispatcher.on("onUpdated",t=>{s(this,M).value=t})}render(){if(!this.args.iobject)return this.node("label",["Invalid property"],{},[],"");h(this,M,this.args.iobject);const e=s(this,M).name||s(this,M).meta.displayName;return this.component(this.control,[this.args.child||""],{property:this.controlProperties,title:e,id:"control"},["{__CODE__3}"],"")}}M=new WeakMap;class ds extends Dt{constructor(){super(),this.control=St,this.controlProperties={type:"number"}}}class ps extends Dt{constructor(){super(),this.control=St}}const ut={[R.FLOAT]:ds,[R.STRING]:ps};var x,le,Le,_e,Mt,ze,_t;class Gt extends A{constructor(){super();a(this,le);a(this,_e);a(this,ze);a(this,x,void 0)}main(){this.reset()}render(){return this.node("div",[this.node("div",[this.node("input",[],{id:{value:"prop_name",keys:[]},class:{value:"primary-input w-full border-r-0 rounded-r-none",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("select",[...Object.keys(ut).map(e=>this.node("option",[e],{value:{value:e,keys:[]}},["{__CODE__1}"],""))],{id:{value:"prop_type",keys:[]},class:{value:"primary-select border-r-0 rounded-r-none rounded-l-none",keys:[]}},["{__CODE__0}"],""),this.node("button",["Add"],{class:{value:"primary-btn rounded-l-none",keys:[]},onclick:{value:d(this,ze,_t),keys:[]}},[],"")],{class:{value:"flex flex-row",keys:[]}},[],""),this.node("div",["{properties}"],{class:{value:"flex flex-col",keys:[]}},["{properties}"],"")],{},[],"")}reset(){s(this,x)&&s(this,x).dispatcher.clearAll(),this.set("{properties}","No Property Manager Found")}refresh(e){s(this,x)&&s(this,x).dispatcher.clearAll(),h(this,x,e),s(this,x).dispatcher.on("propertyAdded",()=>d(this,le,Le).call(this)),s(this,x).dispatcher.on("propertyRemoved",()=>d(this,le,Le).call(this)),d(this,le,Le).call(this)}destroy(){s(this,x)&&s(this,x).dispatcher.clearAll(),super.destroy()}}x=new WeakMap,le=new WeakSet,Le=function(){const{properties:e}=this.key;e("");for(const r in this.child)this.child[r].destroy();const t=s(this,x).properties;for(const[r,i]of t){const n=ut[i.type];n&&e(this.node("div",[this.component(n,[this.node("button",["×"],{class:{value:"primary-btn",keys:[]},onclick:{value:()=>{d(this,_e,Mt).call(this,r)},keys:[]}},[],"")],{id:r,iobject:i},[],"")],{class:{value:"flex flex-row",keys:[]}},[],""),"x++")}},_e=new WeakSet,Mt=function(e){if(!s(this,x)){console.error("Property manager not found");return}s(this,x).removeProperty(e)},ze=new WeakSet,_t=function(){if(!s(this,x)){console.error("Property manager not found");return}const{prop_name:e,prop_type:t}=this.element;s(this,x).addProperty(null,e.value,t.value),e.value=""};var S,j,ce,Oe,Re,zt,Ae,Rt,Fe,At;class ys extends A{constructor(){super();a(this,ce);a(this,Re);a(this,Ae);a(this,Fe);a(this,S,null);a(this,j,null)}main(e){h(this,j,nt(this))}render(){return this.node("div",[this.node("div",[this.node("button",["nodes"],{class:{value:"w-full border-2 border-zinc-900",keys:[]},onclick:{value:()=>this.changeTab("tabNode"),keys:[]}},[],""),this.node("button",["properties"],{class:{value:"w-full border-2 border-zinc-900",keys:[]},onclick:{value:()=>this.changeTab("tabProperties"),keys:[]}},[],""),this.node("button",["stats"],{class:{value:"w-full border-2 border-zinc-900",keys:[]}},[],""),this.node("button",["run"],{class:{value:"w-full border-2 border-zinc-900",keys:[]}},[],""),this.node("button",["debug"],{class:{value:"w-full border-2 border-zinc-900",keys:[]},onclick:{value:()=>this.parent.debug(),keys:[]}},[],""),this.node("button",["export"],{class:{value:"w-full border-2 border-zinc-900",keys:[]},onclick:{value:()=>this.parent.export(),keys:[]}},[],""),this.node("button",["save"],{class:{value:"w-full border-2 border-zinc-900",keys:[]},onclick:{value:()=>this.parent.save(),keys:[]}},[],"")],{},[],""),this.node("div",[this.node("div",[this.node("div",[this.node("label",["Graphs Set"],{},[],"")],{class:{value:"navigator-panel",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.node("div",[this.node("label",["Graphs:"],{},[],""),this.node("div",[this.node("input",[],{class:{value:"primary-input w-full border-r-0 rounded-r-none",keys:[]},placeholder:{value:"Name",keys:[]},id:{value:"graphName",keys:[]}},[],""),this.node("button",["Add"],{class:{value:"primary-btn rounded-l-none",keys:[]},onclick:{value:d(this,Ae,Rt),keys:[]}},[],"")],{class:{value:"flex flex-row",keys:[]}},[],""),this.node("div",["{graphs}"],{class:{value:"space-y-1",keys:[]}},["{graphs}"],"")],{class:{value:"navigator-panel",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.node("div",[this.node("label",["Graphs Set Properties:"],{},[],""),this.component(Gt,[],{id:"graphsetProperties"},[],"")],{class:{value:"navigator-panel",keys:[]}},[],"")],{id:{value:"tabProperties",keys:[]},class:{value:"navigator-tab",keys:[]}},[],""),this.node("div",[this.node("label",["Nodes:"],{class:{value:"text-sm font-semibold border-b-2 border-zinc-500",keys:[]}},[],""),this.component(hs,[],{id:"category",auto:"true"},[],"")],{id:{value:"tabNode",keys:[]},class:{value:"flex-col hidden",keys:[]}},[],"")],{id:{value:"tabs",keys:[]},class:{value:"navigator-container",keys:[]}},[],"")],{class:{value:"flex flex-row h-full",keys:[]}},[],"")}changeTab(e){const{tabs:t}=this.element;t.childNodes.forEach(i=>{i.classList.add("hidden")});const r=this.element[e];r&&r.classList.remove("hidden")}refreshGraphSet(e){s(this,S)&&s(this,S).destroy(),h(this,S,e),s(this,S).dispatcher.on("graphAdded",t=>d(this,ce,Oe).call(this)),s(this,S).dispatcher.on("graphRemoved",t=>d(this,ce,Oe).call(this)),this.child.graphsetProperties.refresh(s(this,S).propertyManager),d(this,ce,Oe).call(this)}destroy(){s(this,j)&&s(this,j).dispatcher.clear("openGraph"),s(this,S)&&(s(this,S).dispatcher.clear("graphAdded"),s(this,S).dispatcher.clear("graphRemoved")),super.destroy()}}S=new WeakMap,j=new WeakMap,ce=new WeakSet,Oe=function(){const{graphs:e}=this.key;e("");const t=s(this,S).graphs;for(const[r,i]of t)e(this.node("div",[this.node("label",[i.custom.name],{class:{value:"w-full text-xs p-1 pl-2",keys:[]},onclick:{value:()=>d(this,Re,zt).call(this,r),keys:[]}},["{__CODE__1}"],""),this.node("button",["×"],{class:{value:"primary-btn m-1",keys:[]},onclick:{value:()=>d(this,Fe,At).call(this,r),keys:[]}},[],"")],{class:{value:"flex flex-row items-center bg-zinc-600 rounded-sm font-semibold select-none",keys:[]}},[],""),"x++")},Re=new WeakSet,zt=function(e){s(this,j)&&s(this,j).dispatcher.emit("openGraph",e)},Ae=new WeakSet,Rt=function(){const{graphName:e}=this.element;if(!e||!e.value){alert("Please enter a name for the graph");return}s(this,S).addGraph(null,{nodes:{},links:[],properties:{},custom:{name:e.value||"no name"},inputs:{},outputs:{}}),e.value="",console.warn("Graph added")},Fe=new WeakSet,At=function(e){s(this,S).removeGraph(e),console.warn("Graph removed")};var Y,ue,Ye,Ft;class ms{constructor(o){a(this,Ye);a(this,Y,null);a(this,ue,null);h(this,Y,o),h(this,ue,d(this,Ye,Ft).bind(this))}register(){if(!s(this,Y)){console.error("ZoomHandler: Invalid target element");return}s(this,Y).addEventListener("mousewheel",s(this,ue))}unregister(){if(!s(this,Y)){console.error("ZoomHandler: Invalid target element");return}s(this,Y).removeEventListener("mousewheel",s(this,ue))}onZoom(){}}Y=new WeakMap,ue=new WeakMap,Ye=new WeakSet,Ft=function(o){o.stopPropagation(),o.preventDefault();const e=s(this,Y),t=e.getBoundingClientRect(),r=o.clientX-t.left,i=o.clientY-t.top,n=o.deltaY>0?-.05:.05,c=Math.min(Math.max(k.zoom+n,k.zoomMin),k.zoomMax),u=c/k.zoom,p=r-r*u,g=i-i*u;e.style.transform=`scale(${c})`,e.style.left=`${(parseFloat(e.style.left||0)||0)+p}px`,e.style.top=`${(parseFloat(e.style.top||0)||0)+g}px`,k.zoom=c,this.onZoom()};var V,H,X,he,de,pe,Ie,ht,Be,Bt;class Yt{constructor(o,e,t){a(this,Ie);a(this,Be);a(this,V,null);a(this,H,null);a(this,X,null);a(this,he,null);a(this,de,null);a(this,pe,null);h(this,V,o),h(this,H,e),h(this,X,t),h(this,he,d(this,Be,Bt).bind(this)),this.gridSize=10,this.isFrame=!1}register(){if(!s(this,H)||!s(this,V)||!s(this,X)){console.error("DragHandler: Invalid target element");return}d(this,Ie,ht).call(this),s(this,H).addEventListener("mousedown",s(this,he))}unregister(){if(!s(this,H)||!s(this,V)||!s(this,X)){console.error("DragHandler: Invalid target element");return}d(this,Ie,ht).call(this),s(this,H).removeEventListener("mousedown",s(this,he))}lastBound(){return{target:s(this,de),parent:s(this,pe)}}onDragEnd(){}}V=new WeakMap,H=new WeakMap,X=new WeakMap,he=new WeakMap,de=new WeakMap,pe=new WeakMap,Ie=new WeakSet,ht=function(){h(this,de,s(this,V).getBoundingClientRect()),h(this,pe,s(this,X).getBoundingClientRect())},Be=new WeakSet,Bt=function(o){o.stopPropagation(),o.preventDefault();const e=s(this,V),t=s(this,X),r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),n=o.clientX-i.left,c=o.clientY-i.top,u=g=>{g.stopPropagation(),g.preventDefault();let I=i.width,O=i.height,K=(g.clientX-r.left-n)/(this.isFrame?1:k.zoom),fe=(g.clientY-r.top-c)/(this.isFrame?1:k.zoom),C=Math.round(K/this.gridSize)*this.gridSize,Q=Math.round(fe/this.gridSize)*this.gridSize;this.isFrame||(C=Math.max(0,Math.min(C,k.size.width-I/k.zoom)),Q=Math.max(0,Math.min(Q,k.size.height-O/k.zoom))),e.style.left=C+"px",e.style.top=Q+"px"},p=g=>{g.stopPropagation(),g.preventDefault(),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",p),h(this,de,e.getBoundingClientRect()),h(this,pe,t.getBoundingClientRect()),this.onDragEnd()};window.addEventListener("mousemove",u),window.addEventListener("mouseup",p)};var w,L,ye,$e,$t,je,jt,Ve,Vt,He,Ht,Xe,Xt;class gs extends A{constructor(){super();a(this,$e);a(this,je);a(this,Ve);a(this,He);a(this,Xe);a(this,w,null);a(this,L,null);a(this,ye,[])}main(){if(!s(this,w)){console.error("Invalid socket");return}h(this,L,nt(this))}render(){if(!this.args.iobject)return this.node("label",["Invalid socket"],{},[],"");h(this,w,this.args.iobject);const e=s(this,w).meta,t=s(this,w).name||e.displayName,r=e.displayColor||"gray",i=s(this,w).type==f.TYPES.OUTPUT,n=s(this,w).isRuntime?this.node("button",["×"],{class:{value:"text-xs font-semibold text-rose-500 mr-1",keys:[]},onclick:{value:d(this,$e,$t),keys:[]}},[],""):"";return this.node("div",[n,this.node("label",[t],{style:{value:"font-size: 10px;",keys:[]}},["{__CODE__3}"],""),this.node("button",[],{id:{value:"btn",keys:[]},style:{value:`background-color: ${r};`,keys:[]},class:{value:`absolute w-3 h-3 ${i?"-right-[6px]":"-left-[6px]"} top-[4px] rounded border-2 border-zinc-800`,keys:[]},onclick:{value:d(this,je,jt),keys:[]},onmousedown:{value:d(this,Xe,Xt),keys:[]}},[],"")],{class:{value:"px-[8px] relative",keys:[]},onmouseover:{value:d(this,Ve,Vt),keys:[]},onmouseleave:{value:d(this,He,Ht),keys:[]}},["{__CODE__2}"],"")}clearLinks(){s(this,ye).forEach(e=>{e.remove()}),h(this,ye,[])}get isocket(){return s(this,w)}getSocketElement(){return this.element.btn}addLink(e){s(this,ye).push(e)}destroy(){this.clearLinks(),super.destroy()}}w=new WeakMap,L=new WeakMap,ye=new WeakMap,$e=new WeakSet,$t=function(){s(this,w).isRuntime&&(s(this,L).dispatcher.emit("clearAllSocketLinks",this),this.parent.removeSocket(s(this,w)))},je=new WeakSet,jt=function(){if(s(this,w).type!=f.TYPES.INPUT||!s(this,L)){console.error("Invalid socket or workspace");return}s(this,L).dispatcher.emit("clearAllSocketLinks",this)},Ve=new WeakSet,Vt=function(){s(this,w).type==f.TYPES.INPUT&&s(this,L).dispatcher.emit("createTargetSocket",this)},He=new WeakSet,Ht=function(){s(this,w).type==f.TYPES.INPUT&&s(this,L).dispatcher.emit("clearTargetSocket",this)},Xe=new WeakSet,Xt=function(e){if(s(this,w).type!==f.TYPES.OUTPUT||!s(this,L))return;e.stopPropagation(),e.preventDefault();const t=s(this,L).dispatcher,r=this,i=this.root,n=this.getSocketElement();if(i){let c=function(p){p.stopPropagation(),p.preventDefault(),t.emit("updateSocketHelper",{socketId:r.id,socketElement:n,x:p.clientX,y:p.clientY})},u=function(p){p.stopPropagation(),p.preventDefault(),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",u),t.emit("clearSocketHelper",r.id),t.emit("clearSourceSocket",r)};t.emit("createSocketHelper",r),t.emit("createSourceSocket",r),window.addEventListener("mousemove",c),window.addEventListener("mouseup",u)}};var m,J,Je,Jt,me,Ce;class ks extends A{constructor(){super();a(this,Je);a(this,me);a(this,m,null);a(this,J,null)}main(e={}){s(this,m)&&(h(this,J,new Yt(this.root,this.root,this.parent.root)),s(this,J).onDragEnd=()=>{const t=this.root.style.left.replace("px",""),r=this.root.style.top.replace("px","");s(this,m).custom.x=Math.round(t)||5,s(this,m).custom.y=Math.round(r)||5},s(this,J).register(),d(this,Je,Jt).call(this),this.renderProperties())}render(){if(!this.args.iobject)return this.node("label",["Invalid node"],{},[],"");h(this,m,this.args.iobject),s(this,m).custom.x==null&&(s(this,m).custom.x=5),s(this,m).custom.y==null&&(s(this,m).custom.y=5);const e=Math.round(s(this,m).custom.x),t=Math.round(s(this,m).custom.y),r=s(this,m).meta,i=s(this,m).name||r.displayName||"Node";r.canCache;const n=s(this,m).isEntry?this.node("button",["(run)"],{onclick:{value:()=>{s(this,m).execute()},keys:[]}},[],""):"";return this.node("div",[this.node("div",[this.node("div",[this.node("label",[i],{id:{value:"handle",keys:[]}},["{__CODE__3}"],""),n],{class:{value:`flex-grow flex items-center space-x-1 ${r.canCache?"text-sky-600":"text-teal-600"}`,keys:[]}},["{__CODE__4}"],""),this.node("button",["×"],{class:{value:"text-rose-700 font-extrabold hidden",keys:[]},onclick:{value:this.removeNode,keys:[]}},[],"")],{id:{value:"header",keys:[]},class:{value:"flex flex-row text-zinc-400 px-2 space-x-2",keys:[]}},[],""),this.node("div",[this.node("div",["{inputs}"],{class:{value:"w-full relative",keys:[]}},["{inputs}"],""),this.node("div",["{outputs}"],{class:{value:"w-full relative text-right",keys:[]}},["{outputs}"],"")],{id:{value:"socket",keys:[]},class:{value:"flex flex-row w-full",keys:[]}},[],""),this.node("div",["{properties}"],{id:{value:"values",keys:[]},class:{value:"px-1",keys:[]},onmousedown:{value:c=>c.stopPropagation(),keys:[]}},["{properties}"],"")],{class:{value:`bg-zinc-800 rounded-sm text-zinc-500 border-2 ${r.canCache?"border-sky-800":"border-teal-800"} text-xs absolute font-semibold select-none py-1`,keys:[]},style:{value:`top: ${t}px; left: ${e}px; min-width: 100px;`,keys:[]}},[],"")}renderProperties(){const{properties:e}=this.key,t=s(this,m).propertyManager.properties;e("");for(const[r,i]of t){if(!i)continue;const n=i.type;if(!n)continue;const c=ut[n];c&&e(this.component(c,[],{iobject:i},[],""),"x++")}}addOutputSocket(e){const r=s(this,m).addOutput(e,"out",ge,!0),{outputs:i}=this.key;d(this,me,Ce).call(this,i,r)}removeSocket(e){const t=e.uuid;e.type==f.TYPES.INPUT?s(this,m).removeInput(t):s(this,m).removeOutput(t),this.child[t].destroy()}destroy(){if(s(this,J)){const e=this.root.style.left.replace("px",""),t=this.root.style.top.replace("px","");s(this,m).custom.x=Math.round(e)||5,s(this,m).custom.y=Math.round(t)||5,s(this,J).unregister()}super.destroy()}}m=new WeakMap,J=new WeakMap,Je=new WeakSet,Jt=function(){const{inputs:e,outputs:t}=this.key,r=s(this,m).inputs,i=s(this,m).outputs;e("");for(const n in r)d(this,me,Ce).call(this,e,r[n]);t("");for(const n in i)d(this,me,Ce).call(this,t,i[n])},me=new WeakSet,Ce=function(e,t){e(this.component(gs,[],{id:t.uuid,iobject:t},[],""),"x++")};var We,Wt;class fs{constructor({source:o,target:e,graph:t}={}){a(this,We);this.uuid=crypto.randomUUID(),this.graph=t,this.source=o,this.target=e,this.line=null,this.fOnMouseDown=this.onMouseDown.bind(this)}remove(){this.line.remove()}getColor(){let o="#3b82f6";const e=this.source.isocket;if(!e)return o;const t=e.meta;return!t||!t.displayColor?o:t.displayColor}create(){const{source:o,target:e,graph:t,fOnMouseDown:r}=this;o.addLink(this),e.addLink(this);const i=k.zoom||1,{x:n,y:c}=t.root.getBoundingClientRect(),u=o.getSocketElement().getBoundingClientRect(),p=(u.left-n+u.width/2.5)/i,g=(u.top-c+u.height/2.5)/i,I=e.getSocketElement().getBoundingClientRect(),O=(I.left-n+I.width/2.5)/i,K=(I.top-c+I.height/2.5)/i;return o.parent.root.addEventListener("mousedown",r),e.parent.root.addEventListener("mousedown",r),this.line=d(this,We,Wt).call(this,p,g,O,K),this.line}onMouseDown(o){const{source:e,target:t,graph:r,line:i}=this,n=k.zoom||1,c=p=>{const{x:g,y:I}=r.root.getBoundingClientRect(),O=e.getSocketElement().getBoundingClientRect(),K=(O.left-g+O.width/2.5)/n,fe=(O.top-I+O.height/2.5)/n,C=t.getSocketElement().getBoundingClientRect(),Q=(C.left-g+C.width/2.5)/n,at=(C.top-I+C.height/2.5)/n;i.setAttributeNS(null,"x1",K),i.setAttributeNS(null,"y1",fe),i.setAttributeNS(null,"x2",Q),i.setAttributeNS(null,"y2",at)},u=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",u)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",u)}}We=new WeakSet,Wt=function(o,e,t,r){const i=this.getColor(),n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttributeNS(null,"x1",o),n.setAttributeNS(null,"y1",e),n.setAttributeNS(null,"x2",t),n.setAttributeNS(null,"y2",r),n.setAttributeNS(null,"style",`stroke:${i};stroke-width:2`),n.setAttributeNS(null,"class","path"),n};var y,W,_,B,Te,dt,Ze,Zt,Pe,pt,qe,qt,Ue,yt,Ke,Kt,Qe,Qt,et,es,tt,ts,st,ss;class vs extends A{constructor(){super();a(this,Te);a(this,Ze);a(this,Pe);a(this,qe);a(this,Ue);a(this,Ke);a(this,Qe);a(this,et);a(this,tt);a(this,st);a(this,y,null);a(this,W,null);a(this,_,null);a(this,B,null);this.sourceSocket=null,this.targetSocket=null,this.helperLinks=new Map}main(e={}){s(this,y)&&(h(this,B,nt(this)),d(this,Ke,Kt).call(this),d(this,Qe,Qt).call(this),d(this,et,es).call(this),d(this,Ze,Zt).call(this),d(this,qe,qt).call(this))}render(){if(!this.args.iobject)return this.node("label",["Invalid graph"],{},[],"");h(this,y,this.args.iobject),s(this,y).custom.x==null&&(s(this,y).custom.x=0),s(this,y).custom.y==null&&(s(this,y).custom.y=0),s(this,y).custom.z==null&&(s(this,y).custom.z=1);const e=Math.round(s(this,y).custom.x),t=Math.round(s(this,y).custom.y),r=k.zoom=parseFloat(s(this,y).custom.z);return this.node("div",[this.node("div",[d(this,Te,dt).call(this,"backGraph"),this.node("div",["{nodes}"],{},["{nodes}"],""),d(this,Te,dt).call(this,"topGraph")],{id:{value:"frame",keys:[]},class:{value:"frame border-2 border-zinc-500 absolute",keys:[]}},["{__CODE__1}","{__CODE__2}"],"")],{class:{value:"absolute",keys:[]},style:{value:`left: ${e}px; top: ${t}px; transform: scale(${r});`,keys:[]}},[],"")}destroy(){if(s(this,B)){const e=s(this,B).dispatcher;e.clear("addNode"),e.clear("createSocketHelper"),e.clear("updateSocketHelper"),e.clear("clearSocketHelper"),e.clear("createSourceSocket"),e.clear("clearSourceSocket"),e.clear("createTargetSocket"),e.clear("clearTargetSocket"),e.clear("clearAllInputLinks")}if(s(this,y)&&(s(this,y).dispatcher.clear("nodeAdded"),s(this,y).dispatcher.clear("socketsLinked")),s(this,W)&&s(this,W).unregister(),s(this,_)){const e=this.root.style.left.replace("px",""),t=this.root.style.top.replace("px","");s(this,y).custom.x=Math.round(e),s(this,y).custom.y=Math.round(t),s(this,y).custom.z=parseFloat(k.zoom).toFixed(4),s(this,_).unregister()}super.destroy()}}y=new WeakMap,W=new WeakMap,_=new WeakMap,B=new WeakMap,Te=new WeakSet,dt=function(e){return this.node("svg",[this.node("defs",[this.node("linearGradient",[this.node("stop",[],{offset:{value:"0%",keys:[]},"stop-color":{value:"white",keys:[]}},[],"http://www.w3.org/2000/svg"),this.node("stop",[],{offset:{value:"100%",keys:[]},"stop-color":{value:"rgba(255,255,255,0.1)",keys:[]}},[],"http://www.w3.org/2000/svg")],{id:{value:"myGradient",keys:[]},x1:{value:"0%",keys:[]},y1:{value:"0%",keys:[]},x2:{value:"100%",keys:[]},y2:{value:"0%",keys:[]}},[],"http://www.w3.org/2000/svg")],{},[],"http://www.w3.org/2000/svg")],{width:{value:k.size.width,keys:[]},height:{value:k.size.height,keys:[]},id:{value:e,keys:[]},class:{value:"absolute select-none pointer-events-none top-0 left-0",keys:[]}},[],"http://www.w3.org/2000/svg")},Ze=new WeakSet,Zt=function(){this.set("{nodes}","");const e=s(this,y).nodes;for(const[t,r]of e)d(this,Pe,pt).call(this,r)},Pe=new WeakSet,pt=function(e){this.set("{nodes}++",this.component(ks,[],{id:e.uuid,iobject:e},[],""))},qe=new WeakSet,qt=function(){queueMicrotask(()=>{const e=s(this,y).links;for(const t of e)d(this,Ue,yt).call(this,t)})},Ue=new WeakSet,yt=function(e={}){const t=this.child[e.sourceNode],r=this.child[e.targetNode];if(!t||!r){console.error("Invalid source or target nodes");return}const i=t.child[e.sourceSocket],n=r.child[e.targetSocket];if(!i||!n){console.error("Invalid source or target socket");return}const u=new fs({source:i,target:n,graph:this}).create();this.element.backGraph.append(u)},Ke=new WeakSet,Kt=function(){const{frame:e}=this.element;e.style.width=k.size.width+"px",e.style.height=k.size.height+"px"},Qe=new WeakSet,Qt=function(){h(this,W,new ms(this.root)),s(this,W).onZoom=()=>{s(this,y).custom.z=k.zoom},s(this,W).register(),h(this,_,new Yt(this.root,this.parent.element.viewport,this.parent.element.viewport)),s(this,_).isFrame=!0,s(this,_).gridSize=1,s(this,_).onDragEnd=()=>{const e=this.root.style.left.replace("px",""),t=this.root.style.top.replace("px","");s(this,y).custom.x=Math.round(e),s(this,y).custom.y=Math.round(t)},s(this,_).register()},et=new WeakSet,es=function(){if(!s(this,B)){console.error("Invalid workplace");return}d(this,tt,ts).call(this),d(this,st,ss).call(this)},tt=new WeakSet,ts=function(){s(this,B).dispatcher.on("addNode",e=>{s(this,y).addNode(null,{class:e})}),s(this,y).dispatcher.on("nodeAdded",e=>{console.warn(`UIGraph: Node ${e.uuid} added`),d(this,Pe,pt).call(this,e)})},st=new WeakSet,ss=function(){const{topGraph:e}=this.element,t=s(this,B).dispatcher;t.on("createSocketHelper",r=>{const i=r.id;let n="#3b82f6";const c=r.isocket;if(c){const p=c.meta;p&&(n=p.displayColor)}const u=this.node("line",[],{x1:{value:0,keys:[]},y1:{value:0,keys:[]},x2:{value:0,keys:[]},y2:{value:0,keys:[]},style:{value:`stroke:${n};stroke-width:2;`,keys:[]},class:{value:"path",keys:[]}},[],"http://www.w3.org/2000/svg");e.append(u),this.helperLinks.set(i,u)}),t.on("updateSocketHelper",({socketId:r,socketElement:i,x:n,y:c})=>{const u=this.helperLinks.get(r);if(u){const p=k.zoom,{x:g,y:I}=this.root.getBoundingClientRect(),{x:O,y:K,width:fe,height:C}=i.getBoundingClientRect(),Q=(O-g+fe/2.5)/p,at=(K-I+C/2.5)/p,os=(n-g)/p,is=(c-I)/p;u.setAttributeNS(null,"x1",Q),u.setAttributeNS(null,"y1",at),u.setAttributeNS(null,"x2",os),u.setAttributeNS(null,"y2",is)}}),t.on("clearSocketHelper",r=>{const i=this.helperLinks.get(r);i&&(i.remove(),this.helperLinks.delete(r))}),t.on("createSourceSocket",r=>{this.sourceSocket=r,console.warn(`Source socket set to ${r.id}`)}),t.on("clearSourceSocket",r=>{const i=this.sourceSocket,n=this.targetSocket;this.sourceSocket=null,this.targetSocket=null,n&&i&&s(this,y).linkSockets(i.isocket,n.isocket)}),t.on("clearAllSocketLinks",r=>{if(!r)return;const i=r.isocket;if(!i)return;if(!s(this,y).clearAllSocketLinks(i)){console.error("Failed to clear socket");return}r.clearLinks(),console.warn("Cleared all sockets links")}),s(this,y).dispatcher.on("socketsLinked",({sourceNode:r,sourceSocket:i,targetNode:n,targetSocket:c})=>{d(this,Ue,yt).call(this,{sourceNode:r,sourceSocket:i,targetNode:n,targetSocket:c})}),t.on("createTargetSocket",r=>{this.sourceSocket&&(this.targetSocket=r,console.warn(`Target socket set to ${r.id}`))}),t.on("clearTargetSocket",r=>{this.sourceSocket&&(this.targetSocket=null,console.warn("Target socket cleared"))})};var mt;class xs extends A{constructor(){super();a(this,mt,null)}main(e){}render(){return this.node("div",[this.node("div",[this.node("label",["Graphs Properties:"],{},[],""),this.component(Gt,[],{id:"graphProperties"},[],"")],{class:{value:"navigator-panel p-2",keys:[]}},[],"")],{},["{__CODE__1}"],"")}refresh(e){if(!e){console.error("No graph provided");return}this.child.graphProperties.refresh(e.propertyManager)}destroy(){super.destroy()}}mt=new WeakMap;var z,Z;class ws extends ft{constructor(){super();a(this,z,null);a(this,Z,null);this.activeGraphUUID=null}main(e){this.load()}async load(){const e=this.args.path;let t=await cs(e);if(!t){alert("Failed to load file");return}t=JSON.parse(t);let r=Object.keys(t)[0];(!r||r.length<5)&&(r=crypto.randomUUID()),this.createEngine(),this.createGraphSet(r,t[r]);const{graph:i}=this.key;i(this.node("label",["No graph selected"],{class:{value:"text-zinc-500 text-xs font-semibold ml-2",keys:[]}},[],"")),this.dispatcher.on("openGraph",n=>this.openGraph(n))}render(){return this.node("div",[this.component(ys,[],{id:"navigator",workspace:this},[],""),this.node("div",["{graph}"],{id:{value:"viewport",keys:[]},class:{value:"viewport w-full relative overflow-hidden border-2 border-zinc-950",keys:[]}},["{graph}"],""),this.node("div",[this.component(xs,[],{id:"graphProperty",workspace:this},[],"")],{class:{value:"border-2 min-w-[250px] max-w-[250px] border-zinc-950",keys:[]}},[],"")],{class:{value:"w-full h-full flex flex-row",keys:[]}},[],"")}export(){const e=s(this,Z).export();console.log(e),console.log(JSON.stringify(e))}async save(){const e=s(this,Z).export(),t=this.args.path;await vt(t,JSON.stringify(e)),alert("Saved")}debug(){console.log(s(this,z))}getViewport(){return this.element.viewport}createEngine(){h(this,z,new Ct),console.warn("IEngine added")}destroyEngine(){s(this,z).destroy(),h(this,z,null),console.warn("IEngine destroyed")}createGraphSet(e,t={properties:{},graphs:{},custom:{}}){h(this,Z,s(this,z).addGraphSet(e,t)),this.child.navigator.refreshGraphSet(s(this,Z)),console.warn("Graph Set added")}openGraph(e){try{const{graph:t}=this.key;if(e||t(this.node("label",["No graph selected"],{class:{value:"text-zinc-500 text-xs font-semibold ml-2",keys:[]}},[],"")),this.activeGraphUUID===e){console.warn("Graph already open");return}t(""),this.child.graph&&this.child.graph.destroy();const r=s(this,Z).getGraph(e);if(!r)throw new Error(`Graph ${e} not found`);this.activeGraphUUID=e,this.child.graphProperty.refresh(r),t(this.component(vs,[],{iobject:r,id:"graph"},[],"")),console.warn("Graph opened")}catch(t){console.error(t||"Error opening graph")}}destroy(){s(this,z)&&s(this,z).destroy(),super.destroy()}}z=new WeakMap,Z=new WeakMap;var rt,rs;class Ss extends A{constructor(){super();a(this,rt)}main(e){}render(){return this.node("div",[this.node("div",[this.node("label",["New Graph Set:"],{class:{value:"text-zinc-400 text-2xl font-semibold",keys:[]}},[],""),this.node("input",[],{type:{value:"text",keys:[]},id:{value:"fileName",keys:[]},class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("div",[this.node("button",["Create"],{class:{value:"primary-btn",keys:[]},onclick:{value:d(this,rt,rs),keys:[]}},[],""),this.node("button",["Cancel"],{class:{value:"primary-btn",keys:[]},onclick:{value:this.destroy,keys:[]}},[],"")],{class:{value:"space-x-1",keys:[]}},[],"")],{class:{value:"bg-zinc-800 p-10 w-full space-y-1",keys:[]}},[],"")],{class:{value:"w-full h-full absolute bg-zinc-900 bg-opacity-90 top-0 left-0 z-30 flex items-center",keys:[]}},[],"")}destroy(){super.destroy()}}rt=new WeakSet,rs=async function(){const{fileName:e}=this.element,t=(e.value.trim()||"untitled")+".ren";await vt(t,"{}"),De.emit("file-written"),this.destroy()};function Es(){xt.set(".ren",ws),De.emit("add-menu","ren-menu","Ren",{New:{"Graph Set":async()=>{De.emit("add-overlay",Ss)}}}),console.warn("registered")}function Is(){xt.delete(".ren"),De.emit("remove-menu","ren-menu"),console.log("unregistered")}export{Es as register,Is as unregister};
