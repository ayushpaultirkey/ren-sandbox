var ns=Object.defineProperty;var as=(l,r,e)=>r in l?ns(l,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[r]=e;var be=(l,r,e)=>(as(l,typeof r!="symbol"?r+"":r,e),e),ot=(l,r,e)=>{if(!r.has(l))throw TypeError("Cannot "+e)};var t=(l,r,e)=>(ot(l,r,"read from private field"),e?e.call(l):r.get(l)),a=(l,r,e)=>{if(r.has(l))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(l):r.set(l,e)},d=(l,r,e,s)=>(ot(l,r,"write to private field"),s?s.call(l,e):r.set(l,e),e);var u=(l,r,e)=>(ot(l,r,"access private method"),e);import{W as gt,H as N,D as ls,b as cs,w as vt,d as He,a as kt}from"./index-dd77522c.js";import{c as pt,d as Le,U as Me,N as ft,I as O,P as it,S as hs}from"./node-5e9651aa.js";function wt(l){let r=l;for(;r;){if(r instanceof gt)return r;r=r.parent}}var T,_,W,se,oe;class xt extends pt{constructor({uuid:e=crypto.randomUUID(),outer:s=null,name:o="Graph"}={}){super({uuid:e,outer:s,name:o});a(this,T,new Map);a(this,_,null);a(this,W,[]);a(this,se,null);a(this,oe,null);d(this,se,new Le({outer:this})),d(this,oe,new Le({outer:this})),this.custom={},d(this,_,new Le({outer:this}))}get nodes(){return t(this,T)}get propertyManager(){return t(this,_)}get links(){return t(this,W)}get inputs(){return t(this,se)}get outputs(){return t(this,oe)}main({properties:e={},nodes:s={},links:o=[],custom:i={}}={}){this.custom=i||{},this.custom.name=i.name||this.name,t(this,_).main(e||{});for(const n in s){const c=s[n];this.addNode(n,c)}for(const n of o){const c=this.getNode(n.sourceNode),h=this.getNode(n.targetNode);this.linkSocketsByUUID(c,n.sourceSocket,h,n.targetSocket)}return t(this,se).addProperty("args0",Me.OBJECT,{},{name:"args?"}),t(this,oe).addProperty("args0",Me.OBJECT,{},{name:"args?"}),!0}addOutput(e,s,o){const i=e||crypto.randomUUID();if(!this.outputs[i])return this.outputs[i]={name:s,type:o},i}getOutputs(){return this.outputs}addNode(e,s={class:null,properties:{},custom:{}}){try{const o=e||crypto.randomUUID();if(t(this,T).has(o))throw new Error(`Graph: Node "${o}" already exists`);if(!s||!s.class)throw new Error("Graph: Node class is required");const i=ft.get(s.class);if(!i)throw new Error(`Graph: Node class "${s.class}" is not registered`);const n=new i({uuid:o,outer:this});return n.main({properties:s.properties,custom:s.custom||{},inputs:s.inputs||{},outputs:s.outputs||{}}),t(this,T).set(o,n),this.dispatcher.emit("nodeAdded",n),n}catch(o){console.error(o)}}getNode(e){return t(this,T).get(e)}removeNodeByUUID(e){const s=this.getNode(e);return this.removeNode(s)}removeNode(e){if(!e)return null;const s=e.inputs;for(const i in s){const n=s[i];this.clearAllSocketLinks(n)}const o=e.outputs;for(const i in o){const n=o[i];this.clearAllSocketLinks(n)}return t(this,T).delete(e.uuid),this.dispatcher.emit("nodeRemoved",e),!0}clearAllSocketLinksByUUID(e,s){const o=this.getNode(e);if(!o)return;const i=o.getSocket(s);if(i)return this.clearAllSocketLinks(i)}clearAllSocketLinks(e){if(!e)return;const s=e.uuid,o=e.outer.uuid;return e.links.forEach(i=>{const n=i.uuid,c=i.outer.uuid;i.unlink(e),d(this,W,t(this,W).filter(h=>!(h.sourceNode==c&&h.sourceSocket==n&&h.targetNode==o&&h.targetSocket==s)))}),e.clear(),!0}linkNodesSocketsByUUID(e,s,o,i){const n=this.getNode(e),c=this.getNode(o);this.linkSocketsByUUID(n,s,c,i)}linkSocketsByUUID(e,s,o,i){if(!e||!o){console.error("Invalid target or source node");return}const n=e.getOutput(s),c=o.getInput(i);return this.linkSockets(n,c)}linkSockets(e,s){if(e.type!==O.TYPES.OUTPUT||s.type!==O.TYPES.INPUT){console.error("Source should be an output socket and target should be an input socket");return}if(!e||!s){console.error("Invalid target or source socket");return}if(e==s){console.error("Source and target socket are the same");return}if(!e.canLinkTo(s)||!s.canLinkTo(e)){console.error("Cannot connect socket");return}e.link(s),s.link(e);const o={sourceNode:e.outer.uuid,sourceSocket:e.uuid,targetNode:s.outer.uuid,targetSocket:s.uuid};return t(this,W).push(o),this.dispatcher.emit("socketsLinked",o),console.warn(`Sockets Linked ${e.uuid} <--> ${s.uuid}`),!0}executeNode(e){const s=this.getNode(e);s&&s.execute()}getEntryNode(){let e=null;return t(this,T).forEach(s=>{s.isEntry&&(e=s)}),e}customExport(){return{}}export(){let e=!0;const s={entry:null,nodes:{},links:[],properties:t(this,_).export(),custom:this.custom};for(const[o,i]of t(this,T)){const{data:n,links:c}=i.export();if(s.nodes[o]=n,s.links.push(...c),i.isEntry){if(s.entry){e=!1;break}s.entry=o}}if(!e){console.error("Multiple entry found");return}return s}}T=new WeakMap,_=new WeakMap,W=new WeakMap,se=new WeakMap,oe=new WeakMap,be(xt,"meta",{className:"IObject.IGraph",displayName:"Graph"});var V,q;class mt extends pt{constructor({uuid:e=crypto.randomUUID(),outer:s=null,name:o="Graph Set"}={}){super({uuid:e,outer:s,name:o});a(this,V,new Map);a(this,q,null);this.custom={},d(this,q,new Le({outer:this,properties:{}}))}get graphs(){return t(this,V)}get propertyManager(){return t(this,q)}main({properties:e={},graphs:s={},custom:o={}}={}){try{this.custom=o||{},this.custom.name=o.name||this.name,t(this,q).main(e);for(const i in s){const n=s[i];this.addGraph(i,n)}return!0}catch(i){console.error(i)}}getGraph(e){try{if(!t(this,V).has(e))throw new Error(`IGraphSet: Graph "${e}" does not exist`);return t(this,V).get(e)}catch(s){console.error(s)}}addGraph(e,s={nodes:{},links:[],properties:{},custom:{},inputs:{},outputs:{}}){try{const o=e||crypto.randomUUID();if(!s)throw new Error("IGraphSet: Graph data is required");if(t(this,V).has(o))throw new Error(`IGraphSet: Graph "${o}" already exists`);const i=new xt({uuid:o,outer:this});return i.signature=s,i.main({nodes:s.nodes,links:s.links,properties:s.properties,custom:s.custom,inputs:s.inputs,outputs:s.outputs}),t(this,V).set(o,i),this.dispatcher.emit("graphAdded",i),i}catch(o){console.error(o)}}removeGraph(e){const s=t(this,V).get(e);return s?(s.destroy(),t(this,V).delete(e),this.dispatcher.emit("graphRemoved"),!0):!1}export(){const e=t(this,V),s={graphs:{},properties:{},custom:this.custom};for(const[o,i]of e){const n=i.export();n&&(s.graphs[o]=n)}return s.properties=t(this,q).export(),{[this.uuid]:s}}destroy(){super.destroy()}}V=new WeakMap,q=new WeakMap,be(mt,"meta",{className:"IObject.GraphSet",displayName:"Graph Set",description:"A collection of graphs"});var $;class St extends pt{constructor({uuid:e=crypto.randomUUID()}={}){super({uuid:e});a(this,$,new Map)}get graphSets(){return t(this,$)}addGraphSet(e,s={properties:{},graphs:{},custom:{}}){try{const o=e||crypto.randomUUID();if(t(this,$).has(o))throw new Error(`Graph set "${o}" already exists`);const i=new mt({uuid:o,outer:this});if(!i.main({properties:s.properties||{},graphs:s.graphs||{}}))throw new Error(`Graph set "${o}" could not be created`);return t(this,$).set(o,i),this.dispatcher.emit("graphSetAdded",i),i}catch(o){console.error(o)}}getGraphSet(e){return t(this,$).get(e)}clearGraphSets(){t(this,$).clear()}destroy(){super.destroy()}}$=new WeakMap,be(St,"meta",{className:"IObject.IEngine",displayName:"Engine"});const y={zoom:1,zoomMax:2,zoomMin:.2,size:{width:6500,height:4e3}};var x,ie,re,ne,K,Ce,bt,Ve,Lt,Ge,Et,ge,rt;class us{constructor(r){a(this,Ce);a(this,Ve);a(this,Ge);a(this,ge);a(this,x,null);a(this,ie,null);a(this,re,null);a(this,ne,null);a(this,K,null);d(this,x,r),d(this,ie,u(this,Ce,bt).bind(this)),d(this,re,u(this,Ve,Lt).bind(this)),d(this,ne,u(this,Ge,Et).bind(this))}register(){if(!t(this,x)){console.error("ZoomHandler: Invalid target element");return}t(this,x).addEventListener("mousewheel",t(this,ie)),t(this,x).addEventListener("touchstart",t(this,re),{passive:!1}),t(this,x).addEventListener("touchmove",t(this,ne),{passive:!1})}unregister(){if(!t(this,x)){console.error("ZoomHandler: Invalid target element");return}t(this,x).removeEventListener("mousewheel",t(this,ie)),t(this,x).removeEventListener("touchstart",t(this,re)),t(this,x).removeEventListener("touchmove",t(this,ne))}onZoom(){}}x=new WeakMap,ie=new WeakMap,re=new WeakMap,ne=new WeakMap,K=new WeakMap,Ce=new WeakSet,bt=function(r){r.stopPropagation(),r.preventDefault();const e=t(this,x),s=e.getBoundingClientRect(),o=r.clientX-s.left,i=r.clientY-s.top,n=r.deltaY>0?-.05:.05,c=Math.min(Math.max(y.zoom+n,y.zoomMin),y.zoomMax),h=c/y.zoom,k=o-o*h,p=i-i*h;e.style.transform=`scale(${c})`,e.style.left=`${(parseFloat(e.style.left||0)||0)+k}px`,e.style.top=`${(parseFloat(e.style.top||0)||0)+p}px`,y.zoom=c,this.onZoom()},Ve=new WeakSet,Lt=function(r){if(r.touches.length===2){r.preventDefault();const[e,s]=r.touches;d(this,K,u(this,ge,rt).call(this,e,s))}},Ge=new WeakSet,Et=function(r){if(r.touches.length===2){r.preventDefault();const[e,s]=r.touches,o=u(this,ge,rt).call(this,e,s);if(t(this,K)!==null){const i=(o-t(this,K))/200,n=Math.min(Math.max(y.zoom+i,y.zoomMin),y.zoomMax),c=t(this,x).getBoundingClientRect(),h=(e.clientX+s.clientX)/2-c.left,k=(e.clientY+s.clientY)/2-c.top,p=n/y.zoom,m=h-h*p,g=k-k*p;t(this,x).style.transform=`scale(${n})`,t(this,x).style.left=`${(parseFloat(t(this,x).style.left||0)||0)+m}px`,t(this,x).style.top=`${(parseFloat(t(this,x).style.top||0)||0)+g}px`,y.zoom=n,this.onZoom()}d(this,K,o)}},ge=new WeakSet,rt=function(r,e){const s=e.clientX-r.clientX,o=e.clientY-r.clientY;return Math.sqrt(s*s+o*o)};var R,A,D,ae,le,Q,ee,ve,nt,Ie,Ht,Pe,Mt;class Nt{constructor(r,e,s){a(this,ve);a(this,Ie);a(this,Pe);a(this,R,null);a(this,A,null);a(this,D,null);a(this,ae,null);a(this,le,null);a(this,Q,null);a(this,ee,null);d(this,R,r),d(this,A,e),d(this,D,s),d(this,ae,u(this,Pe,Mt).bind(this)),d(this,le,u(this,Ie,Ht).bind(this)),this.gridSize=10,this.isFrame=!1}register(){if(!t(this,A)||!t(this,R)||!t(this,D)){console.error("DragHandler: Invalid target element");return}u(this,ve,nt).call(this),t(this,A).addEventListener("mousedown",t(this,ae)),t(this,A).addEventListener("touchstart",t(this,le))}unregister(){if(!t(this,A)||!t(this,R)||!t(this,D)){console.error("DragHandler: Invalid target element");return}u(this,ve,nt).call(this),t(this,A).removeEventListener("mousedown",t(this,ae)),t(this,A).removeEventListener("touchstart",t(this,le))}lastBound(){return{target:t(this,Q),parent:t(this,ee)}}onDragEnd(){}}R=new WeakMap,A=new WeakMap,D=new WeakMap,ae=new WeakMap,le=new WeakMap,Q=new WeakMap,ee=new WeakMap,ve=new WeakSet,nt=function(){d(this,Q,t(this,R).getBoundingClientRect()),d(this,ee,t(this,D).getBoundingClientRect())},Ie=new WeakSet,Ht=function(r){r.stopPropagation(),r.preventDefault();const e=t(this,R),s=t(this,D),o=s.getBoundingClientRect(),i=e.getBoundingClientRect(),n=r.touches[0],c=n.clientX-i.left,h=n.clientY-i.top,k=m=>{const g=m.touches[0];let H=i.width,M=i.height,w=(g.clientX-o.left-c)/(this.isFrame?1:y.zoom),C=(g.clientY-o.top-h)/(this.isFrame?1:y.zoom),z=Math.round(w/this.gridSize)*this.gridSize,ye=Math.round(C/this.gridSize)*this.gridSize;this.isFrame||(z=Math.max(0,Math.min(z,y.size.width-H/y.zoom)),ye=Math.max(0,Math.min(ye,y.size.height-M/y.zoom))),e.style.left=z+"px",e.style.top=ye+"px"},p=m=>{m.stopPropagation(),m.preventDefault(),window.removeEventListener("touchmove",k),window.removeEventListener("touchend",p),d(this,Q,e.getBoundingClientRect()),d(this,ee,s.getBoundingClientRect()),this.onDragEnd()};window.addEventListener("touchmove",k),window.addEventListener("touchend",p)},Pe=new WeakSet,Mt=function(r){r.stopPropagation(),r.preventDefault();const e=t(this,R),s=t(this,D),o=s.getBoundingClientRect(),i=e.getBoundingClientRect(),n=r.clientX-i.left,c=r.clientY-i.top,h=p=>{p.stopPropagation(),p.preventDefault();let m=i.width,g=i.height,H=(p.clientX-o.left-n)/(this.isFrame?1:y.zoom),M=(p.clientY-o.top-c)/(this.isFrame?1:y.zoom),w=Math.round(H/this.gridSize)*this.gridSize,C=Math.round(M/this.gridSize)*this.gridSize;this.isFrame||(w=Math.max(0,Math.min(w,y.size.width-m/y.zoom)),C=Math.max(0,Math.min(C,y.size.height-g/y.zoom))),e.style.left=w+"px",e.style.top=C+"px"},k=p=>{p.stopPropagation(),p.preventDefault(),window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",k),d(this,Q,e.getBoundingClientRect()),d(this,ee,s.getBoundingClientRect()),this.onDragEnd()};window.addEventListener("mousemove",h),window.addEventListener("mouseup",k)};var S,G,ce,B,Te,Ct,Ae,Vt,Ue,Gt,ze,It,ke,at;class ds extends N{constructor(){super();a(this,Te);a(this,Ae);a(this,Ue);a(this,ze);a(this,ke);a(this,S,null);a(this,G,null);a(this,ce,[]);a(this,B,null)}main(){if(!t(this,S)){console.error("Invalid socket");return}d(this,G,wt(this))}removeButton(){return t(this,S).isRuntime?this.node("button",["Ã—"],{class:{value:"text-xs font-semibold text-rose-500 mr-1",keys:[]},onclick:{value:u(this,Te,Ct),keys:[]}},[],""):""}render(){if(!this.args.iobject)return this.node("label",["Invalid socket"],{},[],"");d(this,S,this.args.iobject);const e=t(this,S).meta,s=t(this,S).name||e.displayName,o=e.displayColor||"gray",i=t(this,S).type==O.TYPES.OUTPUT;return this.node("div",[this.node("span",[...this.removeButton()],{},[],""),this.node("label",[s],{},[],""),this.node("button",[],{id:{value:"btn",keys:[]},onclick:{value:u(this,Ae,Vt),keys:[]},ontouchstart:{value:u(this,ke,at),keys:[]},onmousedown:{value:u(this,ke,at),keys:[]},style:{value:`background-color: ${o};`,keys:[]},class:{value:`pin ${i?"right":"left"}`,keys:[]}},[],"")],{class:{value:"pin-holder",keys:[]},onmouseover:{value:u(this,Ue,Gt),keys:[]},onmouseleave:{value:u(this,ze,It),keys:[]},socketuuid:{value:t(this,S).uuid,keys:[]},nodeuuid:{value:t(this,S).outer.uuid,keys:[]}},[],"")}clearLinks(){t(this,ce).forEach(e=>{e.remove()}),d(this,ce,[])}get isocket(){return t(this,S)}getSocketElement(){return this.element.btn}addLink(e){t(this,ce).push(e)}destroy(){this.clearLinks(),super.destroy()}}S=new WeakMap,G=new WeakMap,ce=new WeakMap,B=new WeakMap,Te=new WeakSet,Ct=function(){t(this,S).isRuntime&&(t(this,G).dispatcher.emit("clearAllSocketLinks",this),this.parent.removeSocket(t(this,S)))},Ae=new WeakSet,Vt=function(){if(t(this,S).type!=O.TYPES.INPUT||!t(this,G)){console.error("Invalid socket or workspace");return}t(this,G).dispatcher.emit("clearAllSocketLinks",this)},Ue=new WeakSet,Gt=function(){t(this,S).type==O.TYPES.INPUT&&t(this,G).dispatcher.emit("createTargetSocket",this)},ze=new WeakSet,It=function(){t(this,S).type==O.TYPES.INPUT&&t(this,G).dispatcher.emit("clearTargetSocket",this)},ke=new WeakSet,at=function(e){if(t(this,S).type!==O.TYPES.OUTPUT||!t(this,G))return;e.stopPropagation(),e.preventDefault();const s=t(this,G).dispatcher,o=this,i=this.root,n=this.getSocketElement();if(e.type==="touchstart"&&e.touches.length===1&&d(this,B,{x:e.touches[0].clientX,y:e.touches[0].clientY}),i){let c=function(m){m.stopPropagation(),m.preventDefault(),s.emit("updateSocketHelper",{socketId:o.id,socketElement:n,x:m.clientX,y:m.clientY})},h=function(m){if(m.touches.length===1){const g=m.touches[0];g.clientX-t(o,B).x,g.clientY-t(o,B).y,s.emit("updateSocketHelper",{socketId:o.id,socketElement:n,x:g.clientX,y:g.clientY}),d(o,B,{x:g.clientX,y:g.clientY})}m.stopPropagation(),m.preventDefault()},k=function(m){m.stopPropagation(),m.preventDefault(),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",k),s.emit("clearSocketHelper",o.id),s.emit("clearSourceSocket",o)},p=function(m){m.stopPropagation(),m.preventDefault(),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",p),s.emit("clearSocketHelper",o.id),s.emit("clearSourceSocket",o);const g=t(o,B).x,H=t(o,B).y;document.elementsFromPoint(g,H).forEach(w=>{if(w.hasAttribute("socketuuid")&&w.hasAttribute("nodeuuid")){console.log(w.getAttribute("socketuuid"),w.getAttribute("nodeuuid"));return}})};s.emit("createSocketHelper",o),s.emit("createSourceSocket",o),e.type==="mousedown"?(window.addEventListener("mousemove",c),window.addEventListener("mouseup",k)):e.type==="touchstart"&&(window.addEventListener("touchmove",h),window.addEventListener("touchend",p))}};class ps extends N{constructor(){super(),this.dispatcher=new ls}control(){return""}render(){const r=this.args.title||"Title";return this.node("div",[this.node("label",[r,":"],{class:{value:"text-xs font-semibold text-zinc-400 text-opacity-80",keys:[]}},[],""),this.node("div",[this.control(),this.args.child||""],{class:{value:"flex flex-row w-full",keys:[]}},[],"")],{class:{value:"flex flex-col w-full",keys:[]}},[],"")}getProperty(r){if(this.args.property)return this.args.property[r]}getValue(){}setValue(r){}onUpdate(){}destroy(){this.dispatcher.clearAll(),super.destroy()}}class E extends N{constructor(){super()}render(){const r=this.args.width||"24px",e=this.args.height||"24px",s=this.args.path;return this.node("svg",[this.node("path",[],{d:{value:s,keys:[]}},[],"http://www.w3.org/2000/svg")],{style:{value:`width: ${r}; height: ${e};`,keys:[]},viewBox:{value:"0 0 24 24",keys:[]},class:{value:this.args.class||"",keys:[]}},[],"http://www.w3.org/2000/svg")}}var ms="M5 5H7V11H5V5M10 5H8V11H10V5M5 19H7V13H5V19M10 13H8V19H10V17H15V15H10V13M2 21H4V3H2V21M20 3V7H13V5H11V11H13V9H20V15H18V13H16V19H18V17H20V21H22V3H20Z",ys="M14,12H10V10H14M14,16H10V14H14M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z",Pt="M12,15H10V13H12V15M18,15H14V13H18V15M8,11H6V9H8V11M18,11H10V9H18V11M20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20M4,6V18H20V6H4Z",yt="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",gs="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",vs="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",ks="M20.54,5.23C20.83,5.57 21,6 21,6.5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V6.5C3,6 3.17,5.57 3.46,5.23L4.84,3.55C5.12,3.21 5.53,3 6,3H18C18.47,3 18.88,3.21 19.15,3.55L20.54,5.23M5.12,5H18.87L17.93,4H5.93L5.12,5M12,9.5L6.5,15H10V17H14V15H17.5L12,9.5Z",Tt="M8,5.14V19.14L19,12.14L8,5.14Z",At="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";function Ut(l){l.classList.add("copy-highlight"),setTimeout(()=>l.classList.remove("copy-highlight"),500)}function zt(l,r,e){navigator.clipboard.writeText(r),Ut(l)}async function fs(){try{return await navigator.clipboard.readText()}catch{return null}}var X;class Rt extends N{constructor(){super();a(this,X,null);this.control=ps,this.controlProperties={}}get iproperty(){return t(this,X)}main(){t(this,X)&&(this.build(),this.refresh())}refresh(){this.setValue(t(this,X).value)}build(){}render(){return this.args.iobject?(d(this,X,this.args.iobject),this.node("div",[this.template()],{class:{value:this.args.class||"",keys:[]}},[],"")):this.node("label",["Invalid property"],{},[],"")}template(){return""}updateValue(){t(this,X).value=value}setValue(e){}}X=new WeakMap;class tt extends Rt{constructor(){super()}template(){return this.node("input",[],{id:{value:"valueBox",keys:[]},type:{value:"text",keys:[]},oninput:{value:this.updateValue,keys:[]},class:{value:"primary-input w-full h-full",keys:[]},placeholder:{value:"Value",keys:[]}},[],"")}setValue(r){const{valueBox:e}=this.element;e.value=r}updateValue(){const{valueBox:r}=this.element;this.iproperty.value=r.value}async paste(){Ut(this.root);const r=await fs();this.setValue(r),this.updateValue()}}class ws extends tt{constructor(){super()}template(){return this.node("input",[],{id:{value:"valueBox",keys:[]},type:{value:"number",keys:[]},oninput:{value:this.updateValue,keys:[]},class:{value:"primary-input w-full h-full",keys:[]},placeholder:{value:"Value",keys:[]}},[],"")}}class xs extends tt{constructor(){super()}template(){return this.node("input",[],{id:{value:"valueBox",keys:[]},type:{value:"number",keys:[]},oninput:{value:this.updateValue,keys:[]},class:{value:"primary-input w-full h-full",keys:[]},placeholder:{value:"Value",keys:[]}},[],"")}}class Dt extends tt{constructor(){super()}template(){return this.node("div",[this.node("input",[],{id:{value:"valueBox",keys:[]},disabled:{value:"",keys:[]},type:{value:"text",keys:[]},class:{value:"primary-input w-full pointer-events-none",keys:[]},placeholder:{value:"Reference",keys:[]}},[],"")],{ondblclick:{value:r=>{this.paste()},keys:[]},class:{value:"w-full flex flex-col",keys:[]}},[],"")}}class Ss extends Dt{constructor(){super()}}const lt={[it.FLOAT]:ws,[it.INTEGER]:xs,[it.STRING]:tt,[Me.REFERENCE]:Dt,[Me.GRAPH_SET]:Ss};var f,j,Re,Bt,he,Ee;class bs extends N{constructor(){super();a(this,Re);a(this,he);a(this,f,null);a(this,j,null)}get inode(){return t(this,f)}main(e={}){t(this,f)&&(d(this,j,new Nt(this.root,this.root,this.parent.root)),t(this,j).onDragEnd=()=>{const s=this.root.style.left.replace("px",""),o=this.root.style.top.replace("px","");t(this,f).custom.x=Math.round(s)||50,t(this,f).custom.y=Math.round(o)||50},t(this,j).register(),u(this,Re,Bt).call(this),this.renderProperties())}render(){if(!this.args.iobject)return this.node("label",["Invalid node"],{},[],"");d(this,f,this.args.iobject),t(this,f).custom.x==null&&(t(this,f).custom.x=50),t(this,f).custom.y==null&&(t(this,f).custom.y=50);const e=Math.round(t(this,f).custom.x),s=Math.round(t(this,f).custom.y),o=t(this,f).meta,i=t(this,f).name||o.displayName||"Node",n=o.canCache?"cache":"non-cache",c=t(this,f).isEntry?this.node("button",[this.component(E,[],{path:Tt},[],"")],{class:{value:"node-action fill-green-600",keys:[]},onclick:{value:()=>{t(this,f).execute()},keys:[]}},[],""):"";return this.node("div",[this.node("div",[this.node("div",[this.node("label",[i],{id:{value:"handle",keys:[]}},[],""),c],{class:{value:`${n}`,keys:[]}},[],""),this.node("button",[this.component(E,[],{path:yt},[],"")],{class:{value:"node-close",keys:[]},onclick:{value:this.removeNode,keys:[]}},[],"")],{id:{value:"header",keys:[]},class:{value:"node-title",keys:[]}},[],""),this.node("div",[this.node("div",["{inputs}"],{class:{value:"input",keys:[]}},["{inputs}"],""),this.node("div",["{outputs}"],{class:{value:"output",keys:[]}},["{outputs}"],"")],{id:{value:"socket",keys:[]},class:{value:"node-socket",keys:[]}},[],""),this.node("div",["{properties}"],{id:{value:"nodeProperties",keys:[]},class:{value:"node-property hidden",keys:[]},onmousedown:{value:h=>h.stopPropagation(),keys:[]}},["{properties}"],"")],{class:{value:`node ${n}`,keys:[]},style:{value:`top: ${s}px; left: ${e}px; min-width: 100px;`,keys:[]}},[],"")}removeNode(){this.parent.removeNode(this)}renderProperties(){const{nodeProperties:e}=this.element,{properties:s}=this.key,o=t(this,f).propertyManager.properties;s("");for(const[i,n]of o){if(!n)continue;const c=n.type;if(!c)continue;const h=lt[c];h&&s(this.node("div",[this.node("label",[n.custom.name||"Property",":"],{class:{value:"text-xs font-semibold",keys:[]}},[],""),this.component(h,[],{iobject:n},[],"")],{class:{value:"flex flex-col",keys:[]}},[],""),"x++")}o.size>0&&e.classList.remove("hidden")}addOutputSocket(e){const o=t(this,f).addOutput(e,"out",hs,!0),{outputs:i}=this.key;u(this,he,Ee).call(this,i,o)}removeSocket(e){const s=e.uuid;e.type==O.TYPES.INPUT?t(this,f).removeInput(s):t(this,f).removeOutput(s),this.child[s].destroy()}destroy(){if(t(this,j)){const e=this.root.style.left.replace("px",""),s=this.root.style.top.replace("px","");t(this,f).custom.x=Math.round(e)||5,t(this,f).custom.y=Math.round(s)||5,t(this,j).unregister()}super.destroy()}}f=new WeakMap,j=new WeakMap,Re=new WeakSet,Bt=function(){const{inputs:e,outputs:s}=this.key,o=t(this,f).inputs,i=t(this,f).outputs;e("");for(const n in o)u(this,he,Ee).call(this,e,o[n]);s("");for(const n in i)u(this,he,Ee).call(this,s,i[n])},he=new WeakSet,Ee=function(e,s){e(this.component(ds,[],{id:s.uuid,iobject:s},[],""),"x++")};var De,Yt;class Ls{constructor({source:r,target:e,graph:s}={}){a(this,De);this.uuid=crypto.randomUUID(),this.graph=s,this.source=r,this.target=e,this.line=null,this.fOnMouseDown=this.onMouseDown.bind(this),this.fOnTouchStart=this.onTouchStart.bind(this)}remove(){this.line.remove()}getColor(){let r="#3b82f6";const e=this.source.isocket;if(!e)return r;const s=e.meta;return!s||!s.displayColor?r:s.displayColor}create(){const{source:r,target:e,graph:s,fOnMouseDown:o,fOnTouchStart:i}=this;r.addLink(this),e.addLink(this);const n=y.zoom||1,{x:c,y:h}=s.root.getBoundingClientRect(),k=r.getSocketElement().getBoundingClientRect(),p=(k.left-c+k.width/2)/n,m=(k.top-h+k.height/2)/n,g=e.getSocketElement().getBoundingClientRect(),H=(g.left-c+g.width/2)/n,M=(g.top-h+g.height/2)/n;return r.parent.root.addEventListener("mousedown",o),e.parent.root.addEventListener("mousedown",o),r.parent.root.addEventListener("touchstart",i),e.parent.root.addEventListener("touchstart",i),this.line=u(this,De,Yt).call(this,p,m,H,M),this.line}onMouseDown(r){const{source:e,target:s,graph:o,line:i}=this,n=y.zoom||1,c=k=>{const{x:p,y:m}=o.root.getBoundingClientRect(),g=e.getSocketElement().getBoundingClientRect(),H=(g.left-p+g.width/2)/n,M=(g.top-m+g.height/2)/n,w=s.getSocketElement().getBoundingClientRect(),C=(w.left-p+w.width/2)/n,z=(w.top-m+w.height/2)/n;i.setAttributeNS(null,"x1",H),i.setAttributeNS(null,"y1",M),i.setAttributeNS(null,"x2",C),i.setAttributeNS(null,"y2",z)},h=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",h)}onTouchStart(r){const{source:e,target:s,graph:o,line:i}=this,n=y.zoom||1,c=k=>{const{x:p,y:m}=o.root.getBoundingClientRect(),g=e.getSocketElement().getBoundingClientRect(),H=(g.left-p+g.width/2)/n,M=(g.top-m+g.height/2)/n,w=s.getSocketElement().getBoundingClientRect(),C=(w.left-p+w.width/2)/n,z=(w.top-m+w.height/2)/n;i.setAttributeNS(null,"x1",H),i.setAttributeNS(null,"y1",M),i.setAttributeNS(null,"x2",C),i.setAttributeNS(null,"y2",z)},h=()=>{window.removeEventListener("touchmove",c),window.removeEventListener("touchend",h)};window.addEventListener("touchmove",c),window.addEventListener("touchend",h)}}De=new WeakSet,Yt=function(r,e,s,o){const i=this.getColor(),n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttributeNS(null,"x1",r),n.setAttributeNS(null,"y1",e),n.setAttributeNS(null,"x2",s),n.setAttributeNS(null,"y2",o),n.setAttributeNS(null,"style",`stroke:${i};stroke-width:2`),n.setAttributeNS(null,"class","socket-link"),n};var v,Z,U,Y,fe,ct,Be,Ft,we,ht,Ye,Ot,xe,ut,Fe,$t,Oe,Xt,$e,jt,Xe,Zt,je,Jt;class Es extends N{constructor(){super();a(this,fe);a(this,Be);a(this,we);a(this,Ye);a(this,xe);a(this,Fe);a(this,Oe);a(this,$e);a(this,Xe);a(this,je);a(this,v,null);a(this,Z,null);a(this,U,null);a(this,Y,null);this.sourceSocket=null,this.targetSocket=null,this.helperLinks=new Map}main(e={}){t(this,v)&&(d(this,Y,wt(this)),u(this,Fe,$t).call(this),u(this,Oe,Xt).call(this),u(this,$e,jt).call(this),u(this,Be,Ft).call(this),u(this,Ye,Ot).call(this))}render(){if(!this.args.iobject)return this.node("label",["Invalid graph"],{},[],"");d(this,v,this.args.iobject),t(this,v).custom.x==null&&(t(this,v).custom.x=0),t(this,v).custom.y==null&&(t(this,v).custom.y=0),t(this,v).custom.z==null&&(t(this,v).custom.z=1);const e=Math.round(t(this,v).custom.x),s=Math.round(t(this,v).custom.y),o=y.zoom=parseFloat(t(this,v).custom.z);return this.node("div",[this.node("div",[u(this,fe,ct).call(this,"backGraph"),this.node("div",["{nodes}"],{},["{nodes}"],""),u(this,fe,ct).call(this,"topGraph")],{id:{value:"frame",keys:[]},class:{value:"frame absolute",keys:[]}},[],"")],{class:{value:"absolute",keys:[]},style:{value:`left: ${e}px; top: ${s}px; transform: scale(${o});`,keys:[]}},[],"")}destroy(){if(t(this,Y)){const e=t(this,Y).dispatcher;e.clear("addNode"),e.clear("createSocketHelper"),e.clear("updateSocketHelper"),e.clear("clearSocketHelper"),e.clear("createSourceSocket"),e.clear("clearSourceSocket"),e.clear("createTargetSocket"),e.clear("clearTargetSocket"),e.clear("clearAllInputLinks")}if(t(this,v)&&(t(this,v).dispatcher.clear("nodeAdded"),t(this,v).dispatcher.clear("socketsLinked")),t(this,Z)&&t(this,Z).unregister(),t(this,U)){const e=this.root.style.left.replace("px",""),s=this.root.style.top.replace("px","");t(this,v).custom.x=Math.round(e),t(this,v).custom.y=Math.round(s),t(this,v).custom.z=parseFloat(y.zoom).toFixed(4),t(this,U).unregister()}super.destroy()}removeNode(e){if(!e||!e.inode){console.error("Invalid node");return}if(!t(this,v).removeNode(e.inode)){console.error("Failed to remove node");return}return e.destroy(),console.warn("removed node"),!0}}v=new WeakMap,Z=new WeakMap,U=new WeakMap,Y=new WeakMap,fe=new WeakSet,ct=function(e){return this.node("svg",[this.node("defs",[this.node("linearGradient",[this.node("stop",[],{offset:{value:"0%",keys:[]},"stop-color":{value:"white",keys:[]}},[],"http://www.w3.org/2000/svg"),this.node("stop",[],{offset:{value:"100%",keys:[]},"stop-color":{value:"rgba(255,255,255,0.1)",keys:[]}},[],"http://www.w3.org/2000/svg")],{id:{value:"myGradient",keys:[]},x1:{value:"0%",keys:[]},y1:{value:"0%",keys:[]},x2:{value:"100%",keys:[]},y2:{value:"0%",keys:[]}},[],"http://www.w3.org/2000/svg")],{},[],"http://www.w3.org/2000/svg")],{width:{value:y.size.width,keys:[]},height:{value:y.size.height,keys:[]},id:{value:e,keys:[]},class:{value:"absolute select-none pointer-events-none top-0 left-0",keys:[]}},[],"http://www.w3.org/2000/svg")},Be=new WeakSet,Ft=function(){this.set("{nodes}","");const e=t(this,v).nodes;for(const[s,o]of e)u(this,we,ht).call(this,o)},we=new WeakSet,ht=function(e){this.set("{nodes}++",this.component(bs,[],{id:e.uuid,iobject:e},[],""))},Ye=new WeakSet,Ot=function(){queueMicrotask(()=>{const e=t(this,v).links;for(const s of e)u(this,xe,ut).call(this,s)})},xe=new WeakSet,ut=function(e={}){const s=this.child[e.sourceNode],o=this.child[e.targetNode];if(!s||!o){console.error("Invalid source or target nodes");return}const i=s.child[e.sourceSocket],n=o.child[e.targetSocket];if(!i||!n){console.error("Invalid source or target socket");return}const h=new Ls({source:i,target:n,graph:this}).create();this.element.backGraph.append(h)},Fe=new WeakSet,$t=function(){const{frame:e}=this.element;e.style.width=y.size.width+"px",e.style.height=y.size.height+"px"},Oe=new WeakSet,Xt=function(){d(this,Z,new us(this.root)),t(this,Z).onZoom=()=>{t(this,v).custom.z=y.zoom},t(this,Z).register(),d(this,U,new Nt(this.root,this.parent.element.viewport,this.parent.element.viewport)),t(this,U).isFrame=!0,t(this,U).gridSize=1,t(this,U).onDragEnd=()=>{const e=this.root.style.left.replace("px",""),s=this.root.style.top.replace("px","");t(this,v).custom.x=Math.round(e),t(this,v).custom.y=Math.round(s)},t(this,U).register()},$e=new WeakSet,jt=function(){if(!t(this,Y)){console.error("Invalid workplace");return}u(this,Xe,Zt).call(this),u(this,je,Jt).call(this)},Xe=new WeakSet,Zt=function(){t(this,Y).dispatcher.on("addNode",e=>{t(this,v).addNode(null,{class:e})}),t(this,v).dispatcher.on("nodeAdded",e=>{console.warn(`UIGraph: Node ${e.uuid} added`),u(this,we,ht).call(this,e)})},je=new WeakSet,Jt=function(){const{topGraph:e}=this.element,s=t(this,Y).dispatcher;s.on("createSocketHelper",o=>{const i=o.id;let n="#3b82f6";const c=o.isocket;if(c){const k=c.meta;k&&(n=k.displayColor)}const h=this.node("line",[],{x1:{value:0,keys:[]},y1:{value:0,keys:[]},x2:{value:0,keys:[]},y2:{value:0,keys:[]},style:{value:`stroke:${n};stroke-width:2;`,keys:[]},class:{value:"socket-link",keys:[]}},[],"http://www.w3.org/2000/svg");e.append(h),this.helperLinks.set(i,h)}),s.on("updateSocketHelper",({socketId:o,socketElement:i,x:n,y:c})=>{const h=this.helperLinks.get(o);if(h){const k=y.zoom,{x:p,y:m}=this.root.getBoundingClientRect(),{x:g,y:H,width:M,height:w}=i.getBoundingClientRect(),C=(g-p+M/2)/k,z=(H-m+w/2)/k,ye=(n-p)/k,rs=(c-m)/k;h.setAttributeNS(null,"x1",C),h.setAttributeNS(null,"y1",z),h.setAttributeNS(null,"x2",ye),h.setAttributeNS(null,"y2",rs)}}),s.on("clearSocketHelper",o=>{const i=this.helperLinks.get(o);i&&(i.remove(),this.helperLinks.delete(o))}),s.on("createSourceSocket",o=>{this.sourceSocket=o,console.warn(`Source socket set to ${o.id}`)}),s.on("clearSourceSocket",o=>{const i=this.sourceSocket,n=this.targetSocket;this.sourceSocket=null,this.targetSocket=null,n&&i&&t(this,v).linkSockets(i.isocket,n.isocket)}),s.on("clearAllSocketLinks",o=>{if(!o)return;const i=o.isocket;if(!i)return;if(!t(this,v).clearAllSocketLinks(i)){console.error("Failed to clear socket");return}o.clearLinks(),console.warn("Cleared all sockets links")}),t(this,v).dispatcher.on("socketsLinked",({sourceNode:o,sourceSocket:i,targetNode:n,targetSocket:c})=>{u(this,xe,ut).call(this,{sourceNode:o,sourceSocket:i,targetNode:n,targetSocket:c})}),s.on("createTargetSocket",o=>{this.sourceSocket&&(this.targetSocket=o,console.warn(`Target socket set to ${o.id}`))}),s.on("clearTargetSocket",o=>{this.sourceSocket&&(this.targetSocket=null,console.warn("Target socket cleared"))})};class _t extends N{constructor(){super()}main(r){}render(){return this.node("div",[this.template(),this.node("div",["{tabs}"],{id:{value:"dynamic",keys:[]},class:{value:"hidden",keys:[]}},["{tabs}"],"")],{class:{value:`property-container ${this.args.class||""}`,keys:[]}},[],"")}template(){return""}add(r){r&&(this.set("{tabs}++",r),this.element.dynamic.classList.remove("hidden"))}remove(r){this.child[r].destroy()}switchTab(r){const e=this.child;for(const s in e){const o=e[s];o instanceof st&&(o.id===r?o.root.classList.remove("hidden"):o.root.classList.add("hidden"))}}}class st extends N{constructor(){super(),this.title="",this.class=""}main(r){}render(){const r=this.args.title||this.title||"Title",e=this.args.class||this.class||"";return this.node("div",[this.node("div",[this.node("label",[r],{class:{value:"!text-sm !font-normal",keys:[]}},[],"")],{class:{value:"property text-2xl",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.template()],{class:{value:`property-tab ${e}`,keys:[]}},[],"")}template(){return""}}var ue;class Ns extends N{constructor(){super();a(this,ue,null);this.class=""}get target(){return t(this,ue)}main(e){}setTarget(e){d(this,ue,e)}switchTab(e){t(this,ue).switchTab(e)}render(){const e=this.args.class||this.class||"";return this.node("div",[this.template(),this.node("div",["{dynamic}"],{id:{value:"dynamic",keys:[]},class:{value:"!hidden",keys:[]}},["{dynamic}"],"")],{class:{value:`property-menu ${e}`,keys:[]}},[],"")}template(){return""}add(e){e&&(this.set("{dynamic}++",e),this.element.dynamic.classList.remove("hidden"))}remove(e){this.child[e].destroy()}}ue=new WeakMap;class Hs extends N{constructor(){super(),this.staticFieldCreated=!1,this.staticFields={},this.items=[],this.workplace=null}main(r){r&&r.auto&&this.createCategory(),this.workplace=this.relay.workspace}render(){return this.node("div",[this.node("div",["{staticmenu}"],{},["{staticmenu}"],"")],{class:{value:"select-none",keys:[]}},[],"")}createField(r="",e){const s=r.split(".");s.pop();const i=e.getMeta().displayName;this.items.push(i);for(let n=0;n<s.length;n++){const c=s[n],h=s[n-1],k=n==s.length-1;if(!this.staticFields[c]){const p=this.node("details",[this.node("summary",[c],{class:{value:"text-xs",keys:[]}},[],""),this.node("div",[],{class:{value:"pl-4 flex flex-col space-y-1",keys:[]}},[],"")],{class:{value:"space-y-1",keys:[]},open:{value:"",keys:[]}},[],"");this.staticFields[c]=p,h&&this.staticFields[h]?this.staticFields[h].children[1].appendChild(p):this.set("{staticmenu}++",p)}if(k){const p=e.meta.canCache;this.staticFields[c].children[1].appendChild(this.node("button",[this.component(E,[],{width:"16",height:"16",path:Pt,class:`pointer-events-none ${p?"fill-sky-600":"fill-teal-600"}`},[],""),this.node("label",[i],{class:{value:"pointer-events-none",keys:[]}},[],"")],{onclick:{value:()=>{this.addNode(r)},keys:[]},class:{value:"text-xs font-semibold text-left italic hover:font-semibold hover:underline flex space-x-1 items-center",keys:[]}},[],""))}}}addNode(r){this.workplace&&this.workplace.dispatcher.emit("addNode",r)}createCategory(){if(!this.staticFieldCreated){const r=ft.getAll();for(const[e,s]of r)this.createField(e,s);this.staticFieldCreated=!0}}}var b,de,Ne,Ze,qt,Je,Kt;class Wt extends N{constructor(){super();a(this,de);a(this,Ze);a(this,Je);a(this,b,void 0)}main(){this.reset()}render(){return this.node("div",[this.node("div",[this.node("input",[],{id:{value:"propertyName",keys:[]},class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("select",[...Object.keys(lt).map(e=>this.node("option",[e],{value:{value:e,keys:[]}},[],""))],{id:{value:"propertyType",keys:[]},class:{value:"primary-select",keys:[]},"aria-label":{value:"Property Type",keys:[]}},[],""),this.node("button",[this.component(E,[],{path:At},[],"")],{class:{value:"primary-btn",keys:[]},onclick:{value:u(this,Je,Kt),keys:[]},"aria-label":{value:"Add Property",keys:[]}},[],"")],{class:{value:"flex flex-row space-x-1",keys:[]}},[],""),this.node("div",["{properties}"],{class:{value:"flex flex-col space-y-1 mt-1",keys:[]}},["{properties}"],"")],{class:{value:"select-none",keys:[]}},[],"")}reset(){t(this,b)&&t(this,b).dispatcher.clearAll(),this.set("{properties}",this.node("label",["No Property Manager Found"],{class:{value:"text-xs",keys:[]}},[],""))}refresh(e){if(t(this,b)&&t(this,b).dispatcher.clearAll(),!e){console.error("Invalid property manager");return}d(this,b,e),t(this,b).dispatcher.on("propertyAdded",()=>u(this,de,Ne).call(this)),t(this,b).dispatcher.on("propertyRemoved",()=>u(this,de,Ne).call(this)),u(this,de,Ne).call(this)}destroy(){t(this,b)&&t(this,b).dispatcher.clearAll(),super.destroy()}}b=new WeakMap,de=new WeakSet,Ne=function(){const{properties:e}=this.key;e("");for(const o in this.child){const i=this.child[o];i instanceof Rt&&i.destroy()}const s=t(this,b).properties;for(const[o,i]of s){const n=lt[i.type];n&&e(this.node("div",[this.node("label",[i.custom.name||"no name"," :"],{class:{value:"text-xs font-semibold",keys:[]},ondblclick:{value:c=>{zt(c.target,o,i.custom.name)},keys:[]}},[],""),this.node("div",[this.component(n,[],{id:o,iobject:i,class:"w-full flex"},[],""),this.node("button",[this.component(E,[],{width:"12px",height:"12px",path:yt},[],"")],{class:{value:"primary-btn px-2 pt-[6px]",keys:[]},onclick:{value:()=>{u(this,Ze,qt).call(this,o)},keys:[]},"aria-label":{value:"Remove",keys:[]}},[],"")],{class:{value:"w-full flex flex-row space-x-1",keys:[]}},[],"")],{class:{value:"flex flex-col",keys:[]}},[],""),"x++")}},Ze=new WeakSet,qt=function(e){if(!t(this,b)){console.error("Property manager not found");return}t(this,b).removeProperty(e)},Je=new WeakSet,Kt=function(){if(!t(this,b)){console.error("Property manager not found");return}const{propertyName:e,propertyType:s}=this.element,o=e.value||"untitled",i=s.value;t(this,b).addProperty(o,i,null,{name:o}),e.value=""};var F,L,J,pe,_e,Qt,Se,dt,We,es,qe,ts,Ke,ss;class Ms extends N{constructor(){super();a(this,_e);a(this,Se);a(this,We);a(this,qe);a(this,Ke);a(this,F,null);a(this,L,null);a(this,J,null);a(this,pe,null);d(this,J,u(this,Se,dt).bind(this)),d(this,pe,u(this,_e,Qt).bind(this))}main(){this.set("{graphs}",""),this.load()}render(){return this.node("div",[this.node("div",[this.node("label",["Graphs:"],{},[],""),this.node("div",[this.node("div",[this.node("input",[],{class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]},id:{value:"graphName",keys:[]}},[],""),this.node("button",[this.component(E,[],{path:At},[],"")],{class:{value:"primary-btn",keys:[]},"aria-label":{value:"Add Graph",keys:[]},onclick:{value:u(this,qe,ts),keys:[]}},[],"")],{class:{value:"flex flex-row space-x-1",keys:[]}},[],""),this.node("div",["{graphs}"],{class:{value:"space-y-1",keys:[]}},["{graphs}"],"")],{},[],"")],{class:{value:"property",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.node("div",[this.node("label",["Graphs Set Properties:"],{},[],""),this.node("div",[this.component(Wt,[],{id:"propertyManager"},[],"")],{},[],"")],{class:{value:"property",keys:[]}},[],"")],{class:{value:"select-none",keys:[]}},[],"")}load(){const e=this.relay.workspace;if(!e){console.error("Invalid workspace");return}d(this,F,e),t(this,F).dispatcher.on("graphSetLoaded",t(this,pe))}destroy(){t(this,L)||(t(this,L).dispatcher.off("graphAdded",t(this,J)),t(this,L).dispatcher.off("graphRemoved",t(this,J))),t(this,F)||t(this,F).dispatcher.off("graphSetLoaded",t(this,pe)),super.destroy()}}F=new WeakMap,L=new WeakMap,J=new WeakMap,pe=new WeakMap,_e=new WeakSet,Qt=function(e){t(this,L)&&t(this,L).destroy(),d(this,L,e),t(this,L).dispatcher.on("graphAdded",t(this,J)),t(this,L).dispatcher.on("graphRemoved",t(this,J));const{propertyManager:s}=this.child;s.refresh(e.propertyManager),u(this,Se,dt).call(this)},Se=new WeakSet,dt=function(){const{graphs:e}=this.key;e("");const s=t(this,L).graphs;for(const[o,i]of s)e(this.node("div",[this.node("label",[i.custom.name],{class:{value:"w-full text-xs font-semibold pointer-events-none",keys:[]}},[],""),this.node("button",[this.component(E,[],{width:"12px",height:"12px",path:yt},[],"")],{class:{value:"primary-btn",keys:[]},onclick:{value:n=>{n.stopPropagation(),u(this,Ke,ss).call(this,o)},keys:[]},"aria-label":{value:"Remove Graph",keys:[]}},[],"")],{class:{value:"primary-input bg-opacity-50 flex flex-row items-center pr-1",keys:[]},ondblclick:{value:()=>u(this,We,es).call(this,o),keys:[]},onclick:{value:n=>{n.stopPropagation(),n.preventDefault(),zt(n.target,o,i.custom.name)},keys:[]}},[],""),"x++")},We=new WeakSet,es=function(e){t(this,F)&&t(this,F).dispatcher.emit("openGraph",e)},qe=new WeakSet,ts=function(){const{graphName:e}=this.element;if(!e||!e.value){alert("Please enter a name for the graph");return}const s=e.value||"untitled",o=s;t(this,L).addGraph(o,{custom:{name:s}}),e.value="",console.warn("Graph added")},Ke=new WeakSet,ss=function(e){t(this,L).removeGraph(e),console.warn("Graph removed")};var te,me,Qe,os;class Cs extends N{constructor(){super();a(this,Qe);a(this,te,null);a(this,me,null);d(this,me,u(this,Qe,os).bind(this))}main(e){const s=this.relay.workspace;if(!s){console.error("Invalid workspace");return}d(this,te,s),t(this,te).dispatcher.on("graphOpened",t(this,me))}render(){return this.node("div",[this.node("div",[this.node("label",["Graphs Properties:"],{},[],""),this.node("div",[this.component(Wt,[],{id:"graphProperties"},[],"")],{},[],"")],{class:{value:"property",keys:[]}},[],"")],{},[],"")}destroy(){t(this,te)&&t(this,te).dispatcher.off("graphOpened",t(this,me)),super.destroy()}}te=new WeakMap,me=new WeakMap,Qe=new WeakSet,os=function(e){const{graphProperties:s}=this.child;s.refresh(e.propertyManager)};class Vs extends st{constructor(){super(),this.title="Node Lists"}template(){return this.component(Hs,[],{id:"category",auto:"true"},[],"")}}class Gs extends st{constructor(){super(),this.title="Graph Set"}template(){return this.component(Ms,[],{},[],"")}}class Is extends st{constructor(){super(),this.title="Graph"}template(){return this.component(Cs,[],{},[],"")}}class Ps extends Ns{constructor(){super(),this.workspace=null}main(){this.workspace=this.relay.workspace}template(){return this.node("div",[this.node("button",[this.component(E,[],{path:Pt},[],"")],{title:{value:"Node List",keys:[]},onclick:{value:()=>{this.switchTab("nodeList")},keys:[]}},[],""),this.node("button",[this.component(E,[],{path:ms},[],"")],{title:{value:"Properties",keys:[]},onclick:{value:()=>{this.switchTab("graphSet")},keys:[]}},[],""),this.node("button",[this.component(E,[],{path:Tt},[],"")],{title:{value:"Run",keys:[]}},[],""),this.node("button",[this.component(E,[],{path:ys},[],"")],{title:{value:"Debug",keys:[]},onclick:{value:()=>{this.debug()},keys:[]}},[],""),this.node("button",[this.component(E,[],{path:gs},[],"")],{title:{value:"Property",keys:[]}},[],""),this.node("button",[this.component(E,[],{path:ks},[],"")],{title:{value:"Export",keys:[]},onclick:{value:()=>{this.export()},keys:[]}},[],""),this.node("button",[this.component(E,[],{path:vs},[],"")],{title:{value:"Save",keys:[]},onclick:{value:()=>{this.save()},keys:[]}},[],"")],{},[],"")}save(){this.workspace&&this.workspace.save()}debug(){this.workspace&&this.workspace.debug()}export(){this.workspace&&this.workspace.export()}}class Ts extends _t{constructor(){super()}template(){return this.node("div",[this.component(Vs,[],{id:"nodeList",class:"hidden"},[],""),this.component(Gs,[],{id:"graphSet"},[],"")],{},[],"")}}class As extends _t{constructor(){super()}template(){return this.node("div",[this.component(Is,[],{},[],"")],{},[],"")}}var I,P;class Us extends gt{constructor(){super();a(this,I,null);a(this,P,null);this.activeGraphUUID=null,this.relay={workspace:this,igraphset:()=>t(this,P)}}get iengine(){return t(this,I)}get igraphset(){return t(this,P)}main(e){this.load();const{sideMenu:s,mainProperty:o}=this.child;s.setTarget(o)}async load(){const e=this.args.path;let s=await cs(e);if(!s){alert("Failed to load file");return}s=JSON.parse(s);let o=Object.keys(s)[0];(!o||o.length<5)&&(o=crypto.randomUUID()),this.createEngine(),this.createGraphSet(o,s[o]);const{graph:i}=this.key;i(this.node("label",["No graph selected"],{class:{value:"message",keys:[]}},[],"")),this.dispatcher.on("openGraph",n=>this.openGraph(n))}render(){return this.node("div",[this.component(Ps,[],{id:"sideMenu"},[],""),this.component(Ts,[],{id:"mainProperty"},[],""),this.node("div",["{graph}"],{id:{value:"viewport",keys:[]},class:{value:"viewport",keys:[]}},["{graph}"],""),this.component(As,[],{id:"subProperty"},[],"")],{class:{value:"project-workspace ren-workspace",keys:[]}},[],"")}export(){const e=t(this,P).export(),s=JSON.stringify(e);console.log(e),console.log(s);const o=new Blob([s],{type:"text/plain"}),i=document.createElement("a"),n=URL.createObjectURL(o);i.href=n,i.download=(t(this,P).custom.name||"graphset")+".ren",i.click(),URL.revokeObjectURL(n)}async save(){const e=t(this,P).export(),s=this.args.path;await vt(s,JSON.stringify(e)),alert("Saved")}debug(){console.log(t(this,I))}getViewport(){return this.element.viewport}createEngine(){d(this,I,new St),console.warn("IEngine added")}destroyEngine(){t(this,I).destroy(),d(this,I,null),console.warn("IEngine destroyed")}createGraphSet(e,s={properties:{},graphs:{},custom:{}}){d(this,P,t(this,I).addGraphSet(e,s)),this.dispatcher.emit("graphSetLoaded",t(this,P)),console.warn("Graph Set loaded")}openGraph(e){try{const{graph:s}=this.key;if(e||s(this.node("label",["No graph selected"],{class:{value:"text-zinc-500 text-xs font-semibold ml-2",keys:[]}},[],"")),this.activeGraphUUID===e){console.warn("Graph already open");return}s(""),this.child.graph&&this.child.graph.destroy();const o=t(this,P).getGraph(e);if(!o)throw new Error(`Graph ${e} not found`);this.activeGraphUUID=e,this.dispatcher.emit("graphOpened",o),s(this.component(Es,[],{iobject:o,id:"graph"},[],"")),console.warn("Graph opened")}catch(s){console.error(s||"Error opening graph")}}destroy(){t(this,I)&&t(this,I).destroy(),super.destroy()}}I=new WeakMap,P=new WeakMap;var et,is;class zs extends N{constructor(){super();a(this,et)}main(e){}render(){return this.node("div",[this.node("div",[this.node("label",["New Graph Set:"],{class:{value:"text-zinc-400 text-2xl font-semibold",keys:[]}},[],""),this.node("input",[],{type:{value:"text",keys:[]},id:{value:"fileName",keys:[]},class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("div",[this.node("button",["Create"],{class:{value:"primary-btn",keys:[]},onclick:{value:u(this,et,is),keys:[]}},[],""),this.node("button",["Cancel"],{class:{value:"primary-btn",keys:[]},onclick:{value:this.destroy,keys:[]}},[],"")],{class:{value:"space-x-1",keys:[]}},[],"")],{class:{value:"bg-zinc-800 p-10 w-full space-y-1",keys:[]}},[],"")],{class:{value:"w-full h-full absolute bg-zinc-900 bg-opacity-90 top-0 left-0 z-30 flex items-center",keys:[]}},[],"")}destroy(){super.destroy()}}et=new WeakSet,is=async function(){const{fileName:e}=this.element,s=e.value.trim()||"untitled",o=new mt;o.main({custom:{name:s}});const i=JSON.stringify(o.export());o.destroy(),await vt(`${s}.ren`,i),He.emit("file-written"),this.destroy()};function Ys(){kt.set(".ren",Us),He.emit("add-menu","ren-menu","Ren",{New:{"Graph Set":async()=>{He.emit("add-overlay",zs)}}}),console.warn("registered")}function Fs(){kt.delete(".ren"),He.emit("remove-menu","ren-menu"),console.log("unregistered")}export{Ys as register,Fs as unregister};
