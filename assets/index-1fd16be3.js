var M=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var c=(s,e,t)=>(M(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},O=(s,e,t,i)=>(M(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var f=(s,e,t)=>(M(s,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var v,E,V,g,k,B,W,q,w,P,N,U;const D=class D{constructor(){u(this,E);u(this,k);u(this,W);u(this,w);u(this,N);u(this,v,{});u(this,g,new Map);this.id=D.raid(),this.root=null,this.args={},this.parent=null,this.child={},this.element={},this.key={}}main(e={}){}render(){return this.node("div")}init(){try{return this.root=this.render(),f(this,N,U).call(this,"id",this.element),this.main(this.args),this.root}catch(e){console.error(e)}}node(e="",t=[],i={},r=[],n){const a=n?document.createElementNS(n,e):document.createElement(e);return t.forEach(o=>{const h=typeof o;if(h==="string"){const l=document.createTextNode(o);if(a.append(l),!r||!r.includes(o))return;f(this,E,V).call(this,o,{node:l,type:0,parent:l.parentNode,clone:[]})}else a.append(h==="function"?o.bind(this)():o)}),Object.entries(i).forEach(([o,{keys:h,value:l}])=>{if(h&&h.forEach(d=>f(this,E,V).call(this,d,{node:a,type:2,name:o,map:l})),typeof l=="function"){const d=o.slice(2);o.startsWith("on")?a.addEventListener(d,f(this,W,q).call(this,a,d,l)):a.setAttribute(o,l())}else a.setAttribute(o,l)}),a}destroy(){f(this,k,B).call(this),Object.values(this.child).forEach(e=>e.destroy()),delete this.parent.child[this.id],this.root.remove()}component(e=null,t=[],i={}){if(e instanceof Object){const r=new e;return r.id=i.id||r.id,r.args={...i,child:t[0]},r.parent=this,this.child[r.id]=r,r.init()}}set(e="",t=""){const i=e.indexOf("++");e=e.replace("++","");const r=c(this,v)[e];if(!r)return;const n=typeof t=="function"?t():t;r.element.forEach(o=>{const h=o.node,l=o.parent||h.parentNode;if(o.type==0)t instanceof Element?(l.replaceChild(n,h),o.type=1,o.node=n):f(this,w,P).call(this,t)&&(h.nodeValue=i<0?n:i===0?n+h.nodeValue:h.nodeValue+n);else if(o.type==1){if(t instanceof Element)if(i!==-1){l.insertAdjacentElement(i==0?"afterbegin":"beforeend",n),o.clone.push(n);return}else l.replaceChild(n,h),o.node=n;else if(f(this,w,P).call(this,t)){const d=document.createTextNode(n);l.replaceChild(d,h),o.type=0,o.node=d}o.clone.forEach(d=>{d.remove()}),o.clone=[],h.remove(),f(this,k,B).call(this)}else if(o.type==2&&f(this,w,P).call(this,t)){let d=o.map,y=d.match(/\{[^{}\s]*\}/gm);y&&y.forEach(j=>{if(j===e)d=d.replace(j,n);else{const C=c(this,v)[j];C&&(d=d.replace(j,C.data))}}),h.setAttribute(o.name,d),c(this,v)[e].data=n}})}static raid(){return Math.random().toString(36).slice(6)}};v=new WeakMap,E=new WeakSet,V=function(e,t){if(!this.key[e]){const r=e.replace(/{|}/g,"");this.key[r]=(n,a)=>this.set(a?a.replace(/\w+/gm,e):e,n)}const i=c(this,v);i[e]||(i[e]={element:[],data:""}),i[e].element.push(t)},g=new WeakMap,k=new WeakSet,B=function(e=!1){for(const[t,i]of c(this,g))t.isConnected&&!e||(i.forEach(([r,n])=>t.removeEventListener(r,n)),c(this,g).delete(t))},W=new WeakSet,q=function(e,t,i){let r=i.bind(this),n=c(this,g).get(e)||[];return n.push([t,r]),c(this,g).set(e,n),r},w=new WeakSet,P=function(e){return["string","number","boolean","function"].includes(typeof e)},N=new WeakSet,U=function(e="id",t=this.element){this.root.querySelectorAll(`[${e}]`).forEach(i=>{t[i.getAttribute(e)]=i,i.setAttribute(e,D.raid())})};let m=D;new EventTarget;var p;class G{constructor(){u(this,p,new Map)}on(e,t){c(this,p).has(e)||c(this,p).set(e,[]),c(this,p).get(e).push(t)}off(e,t){c(this,p).has(e)&&c(this,p).set(e,c(this,p).get(e).filter(i=>i!==t))}emit(e,...t){c(this,p).has(e)&&c(this,p).get(e).forEach(i=>i(...t))}once(e,t){const i=(...r)=>{this.off(e,i),t(...r)};this.on(e,i)}clear(e){c(this,p).has(e)&&(c(this,p).delete(e),console.warn(`Event ${e} cleared`))}clearAll(){c(this,p).clear(),console.warn("Event handler cleared")}}p=new WeakMap;const b=new G;console.warn("Event handler initialized");var A,z;class X extends m{constructor(){super();u(this,A)}render(){return this.node("div",[this.node("label",[this.args.title||"Title"],{},[],""),f(this,A,z).call(this,this.args.options||{})],{class:{value:"text-zinc-400 text-xs font-semibold px-2 py-1 rounded-md hover:bg-zinc-600 hover:bg-opacity-40 menu",keys:[]}},[],"")}}A=new WeakSet,z=function(t){const i=[];for(const r in t){let n="",a="";const o=t[r];typeof o=="object"?(n=f(this,A,z).call(this,o),a=this.node("button",[r],{},[],"")):typeof o=="function"&&(a=this.node("button",[r],{onclick:{value:o,keys:[]}},[],""));const h=this.node("div",[a,n],{class:{value:"menu-nested py-1 px-2 min-w-32 hover:bg-zinc-600 hover:bg-opacity-40",keys:[]}},[],"");i.push(h)}return this.node("div",[...i],{class:{value:"py-1 rounded-sm bg-zinc-800 border-2 border-zinc-900 z-20",keys:[]}},[],"")};class Y extends m{constructor(){super()}main(e){this.set("{menu}",""),b.on("add-menu",(t,i,r={})=>{this.child[t]||this.set("{menu}++",this.component(X,[],{id:t,title:i,options:r},[],""))}),b.on("remove-menu",t=>{this.child[t].destroy()})}render(){return this.node("div",["{menu}"],{class:{value:"editor-menu",keys:[]}},["{menu}"],"")}destroy(){b.clear("add-menu"),b.clear("remove-menu"),super.destroy()}}class F extends m{constructor(){super()}render(){return this.node("div",[this.node("button",[this.args.title],{class:{value:"h-full",keys:[]}},[],""),this.node("button",["Ã—"],{class:{value:"text-rose-500",keys:[]},onclick:{value:e=>{e.stopPropagation(),e.preventDefault(),this.parent.closeTab(this.id)},keys:[]}},[],"")],{class:{value:"tab",keys:[]},onclick:{value:e=>{this.parent.setActive(this.id)},keys:[]}},[],"")}}class Q extends m{constructor(){super()}main(){this.set("{tabs}","")}render(){return this.node("div",["{tabs}"],{class:{value:"tab-container",keys:[]}},["{tabs}"],"")}addTab(e,t){this.set("{tabs}++",this.component(F,[],{id:e,title:t},[],""))}removeTab(e){this.child[e].destroy()}setActive(e){for(const t in this.child){const i=this.child[t];i instanceof F&&(i.id===e?i.root.classList.add("active"):i.root.classList.remove("active"))}this.parent.switchWorkspace(e)}closeTab(e){this.child[e].destroy(),this.parent.closeWorkspace(e)}}class Z extends m{constructor(){super(),this.listener=null}main(){const{position:e}=this.key;this.listener=t=>{e(`x: ${t.clientX}, y: ${t.clientY}`)},window.addEventListener("mousemove",this.listener)}render(){return this.node("div",[this.node("label",["{position}"],{class:{value:"p-1 px-2 hover:bg-zinc-600",keys:[]}},["{position}"],"")],{class:{value:"text-xs text-zinc-400 font-semibold flex flex-row justify-end select-none",keys:[]}},[],"")}destroy(){window.removeEventListener("mousemove",this.listener),super.destroy()}}var x;class ee extends m{constructor(){super();u(this,x,!1);this.name="Workspace",this.dispatcher=new G}get isActive(){return c(this,x)}set isActive(t){O(this,x,t),t?this.root.classList.remove("hidden"):this.root.classList.add("hidden")}destroy(){this.dispatcher.clearAll(),super.destroy()}}x=new WeakMap;const te=new Map;var _;class se extends m{constructor(){super();u(this,_,!1)}async main(t){b.on("open-workspace",(i,r)=>{this.openWorkspace(i,r)}),this.set("{workspaces}","")}render(){return this.node("div",[this.node("div",[this.component(Q,[],{id:"tabManager"},[],"")],{class:{value:"project-area-tab",keys:[]}},[],""),this.node("div",["{workspaces}"],{class:{value:"project-area-workspace",keys:[]}},["{workspaces}"],""),this.node("div",[this.component(Z,[],{},[],"")],{class:{value:"project-area-status",keys:[]}},[],"")],{class:{value:"project",keys:[]}},[],"")}async openWorkspace(t,i){const r=crypto.randomUUID(),n=`.${i.split(".").slice(-1)[0]}`,a=te.get(n);if(!a){alert("Invalid file type");return}this.set("{workspaces}++",this.component(a,[],{id:r,path:i},[],""));const{tabManager:o}=this.child;return o.addTab(r,t),o.setActive(r),r}closeWorkspace(t){this.child[t].destroy()}switchWorkspace(t){for(const i in this.child){const r=this.child[i];r instanceof ee&&(r.isActive=!1)}this.child[t].isActive=!0}load(t){try{if(c(this,_))throw new Error("Project already loaded");this.openWorkspace("Explorer",t),this.openWorkspace("another","main.ren"),this.root.classList.remove("hidden"),O(this,_,!0)}catch(i){alert("Failed to load project"),console.error(i)}}destroy(){super.destroy()}}_=new WeakMap;const re={WEB:{path:"fs",file:"web"}},ie={WEB:{path:"argv",file:"web"}},I=re.WEB,ne=ie.WEB,oe="modulepreload",ae=function(s){return"/ren-sandbox/"+s},H={},R=function(e,t,i){if(!t||t.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=ae(n),n in H)return;H[n]=!0;const a=n.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!i)for(let d=r.length-1;d>=0;d--){const y=r[d];if(y.href===n&&(!a||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":oe,a||(l.as="script",l.crossOrigin=""),l.href=n,document.head.appendChild(l),a)return new Promise((d,y)=>{l.addEventListener("load",d),l.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n})},J=(s,e)=>{const t=s[e];return t?typeof t=="function"?t():Promise.resolve(t):new Promise((i,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+e)))})},$=new Map;async function T(s){if($.has(s))return $.get(s);{const e=await J(Object.assign({"./argv/web.js":()=>R(()=>import("./web-758b1622.js"),[]),"./fs/web.js":()=>R(()=>import("./web-307f4943.js"),[])}),`./${s.path}/${s.file}.js`);return $.set(s,e),console.warn(`Handler ${JSON.stringify(s)} loaded`),e}}async function ce(){try{const{readFile:s}=await T(I);return s(...arguments)}catch(s){console.error(s)}}async function le(){try{const{writeFile:s}=await T(I);return s(...arguments)}catch(s){console.error(s)}}async function ye(){try{const{readDirectory:s}=await T(I);return s(...arguments)}catch(s){console.error(s)}}async function de(){const s=await ce("plugins");if(s)return JSON.parse(s);const e=["ren-vs","explorer"];return await le("plugins",JSON.stringify(e)),e}async function he(){const s=await de();for(const e of s){const{register:t}=await J(Object.assign({"../plugin/explorer/main.js":()=>R(()=>import("./main-d903c8d5.js"),[]),"../plugin/ren-vs/main.js":()=>R(()=>import("./main-30bcc642.js"),["assets/main-30bcc642.js","assets/main-f15f607a.css"])}),`../plugin/${e}/main.js`);t()}}async function ue(){try{const{getArguments:s}=await T(ne);return s(...arguments)}catch(s){console.error(s)}}var L,S,K;class pe extends m{constructor(){super();u(this,S);u(this,L,!1)}get isReady(){return c(this,L)}main(t){this.set("{overlay}",""),f(this,S,K).call(this),this.load()}render(){return this.node("div",[this.node("div",[this.component(Y,[],{},[],""),this.component(se,[],{id:"project"},[],"")],{class:{value:"editor-container",keys:[]}},[],""),this.node("div",["{overlay}"],{class:{value:"editor-overlay",keys:[]}},["{overlay}"],"")],{class:{value:"editor",keys:[]}},[],"")}async load(){await he();const t=await ue();!t||!t[0]||(await this.child.project.load(t[0]),O(this,L,!0))}}L=new WeakMap,S=new WeakSet,K=function(){b.on("add-overlay",t=>{this.set("{overlay}++",this.component(t,[],{},[],""))})};class fe extends m{constructor(){super()}main(e){}render(){return this.node("div",[this.component(pe,[],{},[],"")],{class:{value:"w-full h-full overflow-hidden",keys:[]}},[],"")}}document.querySelector(".app").appendChild(new fe().init());export{G as D,m as H,ee as W,te as a,ce as b,b as d,ye as r,le as w};
