var Ss=Object.defineProperty;var Ns=(l,r,t)=>r in l?Ss(l,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[r]=t;var S=(l,r,t)=>(Ns(l,typeof r!="symbol"?r+"":r,t),t),fe=(l,r,t)=>{if(!r.has(l))throw TypeError("Cannot "+t)};var s=(l,r,t)=>(fe(l,r,"read from private field"),t?t.call(l):r.get(l)),a=(l,r,t)=>{if(r.has(l))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(l):r.set(l,t)},h=(l,r,t,e)=>(fe(l,r,"write to private field"),e?e.call(l,t):r.set(l,t),t);var d=(l,r,t)=>(fe(l,r,"access private method"),t);import{H as A,D as bs,W as Ue,b as Es,w as He,d as Bt,a as Ce}from"./index-ed3cee85.js";class Ls extends A{constructor(){super(),this.dispatcher=new bs}control(){return""}render(){const r=this.args.title||"Title";return this.node("div",[this.node("label",[r,":"],{class:{value:"text-xs font-semibold text-zinc-400 text-opacity-80",keys:[]}},[],""),this.node("div",[this.control(),this.args.child||""],{class:{value:"flex flex-row w-full",keys:[]}},[],"")],{class:{value:"flex flex-col w-full",keys:[]}},[],"")}getProperty(r){if(this.args.property)return this.args.property[r]}getValue(){}setValue(r){}onUpdate(){}destroy(){this.dispatcher.clearAll(),super.destroy()}}var I;class Is{constructor(){a(this,I,new Map)}on(r,t){s(this,I).has(r)||s(this,I).set(r,[]),s(this,I).get(r).push(t)}off(r,t){s(this,I).has(r)&&s(this,I).set(r,s(this,I).get(r).filter(e=>e!==t))}emit(r,...t){s(this,I).has(r)&&s(this,I).get(r).forEach(e=>e(...t))}once(r,t){const e=(...o)=>{this.off(r,e),t(...o)};this.on(r,e)}clear(r){s(this,I).has(r)&&(s(this,I).delete(r),console.warn(`Event ${r} cleared`))}clearAll(){s(this,I).clear(),console.warn("Event handler cleared")}}I=new WeakMap;var Pt,Mt,Ut,Ht;class ot{constructor({uuid:r=crypto.randomUUID(),outer:t=null,name:e=null}={}){a(this,Pt,null);a(this,Mt,null);a(this,Ut,null);a(this,Ht,new Is);h(this,Pt,r),h(this,Mt,t),h(this,Ut,e)}main(){}destroy(){s(this,Ht).clearAll()}get dispatcher(){return s(this,Ht)}get uuid(){return s(this,Pt)}get name(){return s(this,Ut)}get outer(){return s(this,Mt)}get meta(){return this.constructor.meta}static getMeta(){return this.meta}}Pt=new WeakMap,Mt=new WeakMap,Ut=new WeakMap,Ht=new WeakMap,S(ot,"meta",{className:"IObject.IObject",displayName:"Object",description:"Object"});var T,R,Ct,dt;const X=class X extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null,name:o=null,type:i=null,isRuntime:n=!1}={}){super({uuid:t,outer:e,name:o});a(this,T,[]);a(this,R,null);a(this,Ct,!1);a(this,dt,null);h(this,R,i),h(this,T,[]),h(this,Ct,n),this.subType=-1,this.validSubTypes=new Set([]),this.maxLinks=1}get links(){return s(this,T)}get type(){return s(this,R)}get isRuntime(){return s(this,Ct)}getValue(){if(s(this,R)==X.TYPES.INPUT){const t=s(this,T)[0];if(!t)return null;const e=t.getNode();return e?(e.meta.canCache||e.execute(),t.getValue()):null}else return s(this,dt)}getValues(){if(s(this,R)==X.TYPES.INPUT){const t=[];return s(this,T).forEach(e=>{if(e){const o=e.getValue();if(!o)return;t.push(o)}}),t}else return[s(this,dt)]}setValue(t){if(s(this,R)==X.TYPES.INPUT){console.error("Cannot set input value");return}h(this,dt,t)}getNode(){return this.outer}isAnyLinked(){return s(this,T).length>0}isLinked(t=0){return!!this.getLink(t)}getLink(t){return s(this,T)[t]}getLinkedNode(t){const e=this.getLink(t);return e?e.outer:null}canLinkTo(t){if(!t||!t.type||!t.outer||t.type==s(this,R)){console.error("Invalid socket, type, or same socket type");return}if(t.outer==this.outer){console.error("Source and target sockets are the same");return}if(s(this,R)==X.TYPES.INPUT&&!this.validSubTypes.has(t.subType)){console.error("Invalid sub-socket type");return}if(s(this,T).length>=this.maxLinks){console.error("Link limit failed");return}return!0}link(t){s(this,T).push(t)}unlink(t){h(this,T,s(this,T).filter(e=>e!=t))}clear(){h(this,T,[])}export(){let t=[];return this.type!==X.TYPES.OUTPUT||this.links.forEach(e=>{!e||!e.outer||!this.outer||t.push({sourceNode:this.outer.uuid,sourceSocket:this.uuid,targetNode:e.outer.uuid,targetSocket:e.uuid})}),t}};T=new WeakMap,R=new WeakMap,Ct=new WeakMap,dt=new WeakMap,S(X,"meta",{className:"IObject.Socket",displayName:"Socket",displayColor:"gray"}),S(X,"TYPES",{INPUT:1,OUTPUT:2});let x=X;var pt,rt,mt;class Ve extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null,name:o=null,type:i=null,value:n=null,custom:c=null}={}){super({uuid:t,outer:e,name:o});a(this,pt,null);a(this,rt,null);a(this,mt,null);h(this,pt,i),h(this,rt,n),h(this,mt,c)}get value(){return s(this,rt)}set value(t){h(this,rt,t)}get type(){return s(this,pt)}get custom(){return s(this,mt)}export(){return{name:this.name,type:s(this,pt),value:s(this,rt),custom:s(this,mt)}}}pt=new WeakMap,rt=new WeakMap,mt=new WeakMap,S(Ve,"meta",{className:"IObject.IProperty",displayName:"Data"});const $={STRING:"STRING",BOOLEAN:"BOOLEAN",INT:"INT",FLOAT:"FLOAT",WILDCARD:"WILDCARD"},we={OBJECT:"OBJECT"},Me={FUNCTION:"FUNCTION",EVENT:"EVENT"};var V;class ge extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null,name:o="Property Manager"}={}){super({uuid:t,outer:e,name:o});a(this,V,new Map)}main(t={}){try{for(const e in t){const o=t[e],i=o.type,n=o.name,c=o.value,u=o.custom;this.addProperty(e,n,i,c,u)}}catch(e){console.error(e)}}get properties(){return s(this,V)}addProperty(t,e,o,i=null,n={}){try{const c=t||crypto.randomUUID();if(!e)throw new Error("PropertyManager: Property name is required");if(s(this,V).has(e))throw new Error(`PropertyManager: Property "${e}" already exists`);const u=$[o]||we[o];if(!u)throw new Error(`PropertyManager: Invalid type "${o}"`);const p=new Ve({uuid:c,outer:this,name:e,type:u,value:i,custom:n});s(this,V).set(c,p),this.dispatcher.emit("propertyAdded",p)}catch(c){console.error(c)}}removeProperty(t){return s(this,V).delete(t)?(this.dispatcher.emit("propertyRemoved",t),!0):!1}getProperty(t){try{if(!s(this,V).has(t))throw new Error(`PropertyManager: Property "${t}" does not exist`);return s(this,V).get(t)}catch(e){console.error(e)}}setProperty(t,e){try{if(!s(this,V).has(t))throw new Error(`PropertyManager: Property "${t}" does not exist`);const o=this.getProperty(t);o.value=e}catch(o){console.error(o)}}export(){const t=s(this,V),e={};for(const[o,i]of t){const n=i.export();n&&(e[o]=n)}return e}}V=new WeakMap,S(ge,"meta",{className:"IObject.PropertyManager",displayName:"Property Manager"});class De extends x{constructor({uuid:r=crypto.randomUUID(),outer:t=null,name:e="float",type:o=null,isRuntime:i=!1}){super({uuid:r,outer:t,name:e,type:o,isRuntime:i}),this.subType=$.FLOAT,this.validSubTypes=new Set([$.INT,$.FLOAT]),this.maxLinks=o==x.TYPES.OUTPUT?100:1}}S(De,"meta",{className:"ISocket.FloatSocket",displayName:"Float",displayColor:"#059669"});class bt extends x{constructor({uuid:r=crypto.randomUUID(),outer:t=null,name:e="string",type:o=null,isRuntime:i=!1}){super({uuid:r,outer:t,name:e,type:o,isRuntime:i}),this.subType=$.STRING,this.validSubTypes=new Set([$.STRING]),this.maxLinks=o==x.TYPES.OUTPUT?100:1}}S(bt,"meta",{className:"ISocket.StringSocket",displayName:"String",displayColor:"#d946ef"});var it,D,M;class Et extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null}={}){super({uuid:t,outer:e});a(this,it,null);a(this,D,{});a(this,M,{});this.custom={},this.isEntry=!1,h(this,it,new ge({outer:this}))}get inputs(){return s(this,D)}get outputs(){return s(this,M)}get propertyManager(){return s(this,it)}main({properties:t={},custom:e={},inputs:o={},outputs:i={}}={}){try{e&&(this.custom=e);for(const n in o){const c=o[n],u=bt;this.addInput(n,c.name,u,!0)}for(const n in i){const c=i[n],u=bt;this.addOutput(n,c.name,u,!0)}for(const n in t){const c=t[n];s(this,it).setProperty(n,c.value)}return!0}catch(n){console.error(n)}}addInput(t,e,o,i=!1){if(!o||s(this,D)[t])return null;const n=new o({uuid:t,outer:this,name:e,type:x.TYPES.INPUT,isRuntime:i});return s(this,D)[t]=n,n}removeInput(t){if(s(this,D)[t].isRuntime)return delete s(this,D)[t],!0;console.error("Cannot remove static socket")}addOutput(t,e,o,i=!1){if(!o){console.error("Invalid socket class");return}if(s(this,M)[t]){console.error("Socket already exists");return}const n=new o({uuid:t,outer:this,name:e,type:x.TYPES.OUTPUT,isRuntime:i});return s(this,M)[t]=n,n}removeOutput(t){if(s(this,M)[t].isRuntime)return delete s(this,M)[t],!0;console.error("Cannot remove static socket")}getInput(t){return s(this,D)[t]}getOutput(t){return s(this,M)[t]}getSocket(t){return this.getInput(t)||this.getOutput(t)}execute(){}executeLinkedNode(t,e=0){const o=this.getSocket(t);if(o&&o.isLinked(e)){const i=o.getLinkedNode(e);i&&i.execute()}}customExport(){return null}export(){const t={class:this.meta.className,properties:s(this,it).export(),custom:this.custom||{},inputs:{},outputs:{}};for(const o in s(this,D)){const i=s(this,D)[o];i.isRuntime&&(t.inputs[o]={name:i.name||"in",type:i.subType})}for(const o in s(this,M)){const i=s(this,M)[o];i.isRuntime&&(t.outputs[o]={name:i.name||"out",type:i.subType})}let e=[];for(const o in s(this,M)){const i=s(this,M)[o];e=e.concat(i.export())}return{data:t,links:e}}}it=new WeakMap,D=new WeakMap,M=new WeakMap,S(Et,"meta",{className:"IObject.INode",displayName:"Node",canCache:!0});const It=new Map,ke={register:function(l,r){It.set(l,r)},registerMany:function(l={}){for(const r in l)this.register(r,l[r])},unregister:function(l){return It.delete(l)},get:function(l){return It.get(l)},getAll:function(){return It.entries()},isRegistered:function(l){return It.has(l)}};var z,nt,at,$t,jt;class Ge extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null,name:o="Graph"}={}){super({uuid:t,outer:e,name:o});a(this,z,new Map);a(this,nt,null);a(this,at,[]);a(this,$t,null);a(this,jt,null);this.custom={},h(this,nt,new ge({outer:this}))}get nodes(){return s(this,z)}get propertyManager(){return s(this,nt)}get links(){return s(this,at)}get inputs(){return s(this,$t)}get outputs(){return s(this,jt)}main({properties:t={},nodes:e={},links:o=[],custom:i={},inputs:n={},outputs:c={}}={}){this.custom=i||{},this.custom.name=i.name||this.name,s(this,nt).main(t||{});for(const u in e){const p=e[u];this.addNode(u,p)}for(const u of o){const p=this.getNode(u.sourceNode),m=this.getNode(u.targetNode);this.linkSocketsByUUID(p,u.sourceSocket,m,u.targetSocket)}return!0}addOutput(t,e,o){const i=t||crypto.randomUUID();if(!this.outputs[i])return this.outputs[i]={name:e,type:o},i}getOutputs(){return this.outputs}addNode(t,e={class:null,properties:{},custom:{}}){try{const o=t||crypto.randomUUID();if(s(this,z).has(o))throw new Error(`Graph: Node "${o}" already exists`);if(!e||!e.class)throw new Error("Graph: Node class is required");const i=ke.get(e.class);if(!i)throw new Error(`Graph: Node class "${e.class}" is not registered`);const n=new i({uuid:o,outer:this});return n.main({properties:e.properties,custom:e.custom||{},inputs:e.inputs||{},outputs:e.outputs||{}}),s(this,z).set(o,n),this.dispatcher.emit("nodeAdded",n),n}catch(o){console.error(o)}}getNode(t){return s(this,z).get(t)}removeNodeByUUID(t){const e=this.getNode(t);return this.removeNode(e)}removeNode(t){if(!t)return null;const e=t.inputs;for(const i in e){const n=e[i];this.clearAllSocketLinks(n)}const o=t.outputs;for(const i in o){const n=o[i];this.clearAllSocketLinks(n)}return s(this,z).delete(t.uuid),!0}clearAllSocketLinksByUUID(t,e){const o=this.getNode(t);if(!o)return;const i=o.getSocket(e);if(i)return this.clearAllSocketLinks(i)}clearAllSocketLinks(t){if(!t)return;const e=t.uuid,o=t.outer.uuid;return t.links.forEach(i=>{const n=i.uuid,c=i.outer.uuid;i.unlink(t),h(this,at,s(this,at).filter(u=>!(u.sourceNode==c&&u.sourceSocket==n&&u.targetNode==o&&u.targetSocket==e)))}),t.clear(),!0}linkNodesSocketsByUUID(t,e,o,i){const n=this.getNode(t),c=this.getNode(o);this.linkSocketsByUUID(n,e,c,i)}linkSocketsByUUID(t,e,o,i){if(!t||!o){console.error("Invalid target or source node");return}const n=t.getOutput(e),c=o.getInput(i);return this.linkSockets(n,c)}linkSockets(t,e){if(t.type!==x.TYPES.OUTPUT||e.type!==x.TYPES.INPUT){console.error("Source should be an output socket and target should be an input socket");return}if(!t||!e){console.error("Invalid target or source socket");return}if(t==e){console.error("Source and target socket are the same");return}if(!t.canLinkTo(e)||!e.canLinkTo(t)){console.error("Cannot connect socket");return}t.link(e),e.link(t);const o={sourceNode:t.outer.uuid,sourceSocket:t.uuid,targetNode:e.outer.uuid,targetSocket:e.uuid};return s(this,at).push(o),this.dispatcher.emit("socketsLinked",o),console.warn(`Sockets Linked ${t.uuid} <--> ${e.uuid}`),!0}executeNode(t){const e=this.getNode(t);e&&e.execute()}getEntryNode(){let t=null;return s(this,z).forEach(e=>{e.isEntry&&(t=e)}),t}customExport(){return{}}export(){let t=!0;const e={entry:null,nodes:{},links:[],properties:s(this,nt).export(),custom:this.custom};for(const[o,i]of s(this,z)){const{data:n,links:c}=i.export();if(e.nodes[o]=n,e.links.push(...c),i.isEntry){if(e.entry){t=!1;break}e.entry=o}}if(!t){console.error("Multiple entry found");return}return e}}z=new WeakMap,nt=new WeakMap,at=new WeakMap,$t=new WeakMap,jt=new WeakMap,S(Ge,"meta",{className:"IObject.IGraph",displayName:"Graph"});var G,lt;class Oe extends ot{constructor({uuid:t=crypto.randomUUID(),outer:e=null,name:o="Graph Set"}={}){super({uuid:t,outer:e,name:o});a(this,G,new Map);a(this,lt,null);this.custom={},h(this,lt,new ge({outer:this,properties:{}}))}get graphs(){return s(this,G)}get propertyManager(){return s(this,lt)}main({properties:t={},graphs:e={},custom:o={}}={}){try{this.custom=o||{},this.custom.name=o.name||this.name,s(this,lt).main(t);for(const i in e){const n=e[i];this.addGraph(i,n)}return!0}catch(i){console.error(i)}}getGraph(t){try{if(!s(this,G).has(t))throw new Error(`IGraphSet: Graph "${t}" does not exist`);return s(this,G).get(t)}catch(e){console.error(e)}}addGraph(t,e={nodes:{},links:[],properties:{},custom:{},inputs:{},outputs:{}}){try{const o=t||crypto.randomUUID();if(!e)throw new Error("IGraphSet: Graph data is required");if(s(this,G).has(o))throw new Error(`IGraphSet: Graph "${o}" already exists`);const i=new Ge({uuid:o,outer:this});return i.main({nodes:e.nodes,links:e.links,properties:e.properties,custom:e.custom,inputs:e.inputs,outputs:e.outputs}),s(this,G).set(o,i),this.dispatcher.emit("graphAdded",i),i}catch(o){console.error(o)}}removeGraph(t){const e=s(this,G).get(t);return e?(e.destroy(),s(this,G).delete(t),this.dispatcher.emit("graphRemoved"),!0):!1}export(){const t=s(this,G),e={graphs:{},properties:{},custom:this.custom};for(const[o,i]of t){const n=i.export();n&&(e.graphs[o]=n)}return e.properties=s(this,lt).export(),{[this.uuid]:e}}destroy(){super.destroy()}}G=new WeakMap,lt=new WeakMap,S(Oe,"meta",{className:"IObject.GraphSet",displayName:"Graph Set",description:"A collection of graphs"});class Ae extends Et{constructor({uuid:r,outer:t}){super({uuid:r,outer:t})}main(r){this.addOutput("value0","value",De),this.propertyManager.addProperty("value0","value",$.FLOAT,0),super.main(r)}execute(){let r=this.propertyManager.getProperty("value").value;isNaN(r)?r=null:r=parseFloat(r),this.getOutput("value0").setValue(r)}}S(Ae,"meta",{className:"INode.Value.MakeFloat",displayName:"Make Float",canCache:!1});class Re extends Et{constructor({uuid:r,outer:t}){super({uuid:r,outer:t})}main(r){this.addOutput("value0","value",bt),this.propertyManager.addProperty("value0","value",$.STRING,""),super.main(r)}execute(){const t=this.propertyManager.getProperty("value0").value;this.getOutput("value0").setValue(t)}}S(Re,"meta",{className:"INode.Value.MakeString",displayName:"Make String",canCache:!1});ke.registerMany({"INode.Value.MakeFloat":Ae,"INode.Value.MakeString":Re});class Pe extends x{constructor({uuid:r=crypto.randomUUID(),outer:t=null,name:e="object",type:o=null,isRuntime:i=!1}){super({uuid:r,outer:t,name:e,type:o,isRuntime:i}),this.subType=we.OBJECT,this.validSubTypes=new Set([we.OBJECT]),this.maxLinks=o==x.TYPES.OUTPUT?100:1}}S(Pe,"meta",{className:"ISocket.Object",displayName:"Object",displayColor:"#14b8a6"});class Tt extends x{constructor({uuid:r=crypto.randomUUID(),outer:t=null,name:e="exec",type:o=null,isRuntime:i=!1}){super({uuid:r,outer:t,name:e,type:o,isRuntime:i}),this.subType=Me.FUNCTION,this.validSubTypes=new Set([Me.FUNCTION]),this.maxLinks=o==x.TYPES.OUTPUT?1:100}}S(Tt,"meta",{className:"ISocket.ExecutionSocket",displayName:"Exec",displayColor:"#94a3b8"});class ze extends Et{constructor({uuid:r,outer:t}){super({uuid:r,outer:t}),this.isEntry=!0}main(r){this.addOutput("out0","out",Tt),this.addOutput("args0","args?",Pe),super.main(r)}execute(){console.log("begin"),this.executeLinkedNode("out0",0)}}S(ze,"meta",{className:"INode.Event.Begin",displayName:"Begin",canCache:!0});class Ye extends Et{constructor({uuid:r,outer:t}){super({uuid:r,outer:t})}main(r){this.addInput("in0","in",Tt),this.addInput("value1","value",bt),this.addOutput("out0","out",Tt),super.main(r)}execute(){let r=this.getInput("value1").getValue();console.log("log",r),this.executeLinkedNode("out0",0)}}S(Ye,"meta",{className:"INode.Event.Log",displayName:"Log",canCache:!0});class Fe extends Et{constructor({uuid:r,outer:t}){super({uuid:r,outer:t})}main(r){this.addInput("in0","in",Tt),this.addInput("args0","args?",Pe),super.main(r)}execute(){console.log("end")}}S(Fe,"meta",{className:"INode.Event.Return",displayName:"Return",canCache:!0});ke.registerMany({"INode.Event.Begin":ze,"INode.Event.Log":Ye,"INode.Event.Return":Fe});var Q;class Be extends ot{constructor({uuid:t=crypto.randomUUID()}={}){super({uuid:t});a(this,Q,new Map)}get graphSets(){return s(this,Q)}addGraphSet(t,e={properties:{},graphs:{},custom:{}}){try{const o=t||crypto.randomUUID();if(s(this,Q).has(o))throw new Error(`Graph set "${o}" already exists`);const i=new Oe({uuid:o,outer:this});if(!i.main({properties:e.properties||{},graphs:e.graphs||{}}))throw new Error(`Graph set "${o}" could not be created`);return s(this,Q).set(o,i),this.dispatcher.emit("graphSetAdded",i),i}catch(o){console.error(o)}}getGraphSet(t){return s(this,Q).get(t)}clearGraphSets(){s(this,Q).clear()}destroy(){super.destroy()}}Q=new WeakMap,S(Be,"meta",{className:"IObject.IEngine",displayName:"Engine"});const g={zoom:1,zoomMax:2,zoomMin:.3,size:{width:1250,height:850}};function ve(l){let r=l;for(;r;){if(r instanceof Ue)return r;r=r.parent}}var Ts="M5 5H7V11H5V5M10 5H8V11H10V5M5 19H7V13H5V19M10 13H8V19H10V17H15V15H10V13M2 21H4V3H2V21M20 3V7H13V5H11V11H13V9H20V15H18V13H16V19H18V17H20V21H22V3H20Z",Ps="M14,12H10V10H14M14,16H10V14H14M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z",$e="M12,15H10V13H12V15M18,15H14V13H18V15M8,11H6V9H8V11M18,11H10V9H18V11M20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20M4,6V18H20V6H4Z",je="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",Ms="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",Us="M20.54,5.23C20.83,5.57 21,6 21,6.5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V6.5C3,6 3.17,5.57 3.46,5.23L4.84,3.55C5.12,3.21 5.53,3 6,3H18C18.47,3 18.88,3.21 19.15,3.55L20.54,5.23M5.12,5H18.87L17.93,4H5.93L5.12,5M12,9.5L6.5,15H10V17H14V15H17.5L12,9.5Z",Hs="M8,5.14V19.14L19,12.14L8,5.14Z",Xe="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";class C extends A{constructor(){super()}render(){const r=this.args.width||"24px",t=this.args.height||"24px",e=this.args.path;return this.node("svg",[this.node("path",[],{d:{value:e,keys:[]}},[],"http://www.w3.org/2000/svg")],{style:{value:`width: ${r}; height: ${t};`,keys:[]},viewBox:{value:"0 0 24 24",keys:[]},class:{value:this.args.class||"",keys:[]}},[],"http://www.w3.org/2000/svg")}}class Cs extends A{constructor(){super(),this.staticFieldCreated=!1,this.staticFields={},this.items=[],this.workplace=null}main(r){r&&r.auto&&this.createCategory(),this.workplace=ve(this)}render(){return this.node("div",[this.node("div",["{staticmenu}"],{},["{staticmenu}"],"")],{class:{value:"select-none",keys:[]}},[],"")}createField(r="",t){const e=r.split(".");e.pop();const i=t.getMeta().displayName;this.items.push(i);for(let n=0;n<e.length;n++){const c=e[n],u=e[n-1],p=n==e.length-1;if(!this.staticFields[c]){const m=this.node("details",[this.node("summary",[c],{class:{value:"text-xs",keys:[]}},[],""),this.node("div",[],{class:{value:"pl-4 flex flex-col space-y-1",keys:[]}},[],"")],{class:{value:"space-y-1",keys:[]},open:{value:"",keys:[]}},[],"");this.staticFields[c]=m,u&&this.staticFields[u]?this.staticFields[u].children[1].appendChild(m):this.set("{staticmenu}++",m)}if(p){const m=t.meta.canCache;this.staticFields[c].children[1].appendChild(this.node("button",[this.component(C,[],{width:"16",height:"16",path:$e,class:m?"fill-blue-600":"fill-teal-600"},[],""),this.node("label",[i],{},[],"")],{onclick:{value:()=>{this.addNode(r)},keys:[]},class:{value:"text-xs font-semibold text-left italic hover:font-semibold hover:underline flex space-x-1 items-center",keys:[]}},[],""))}}}addNode(r){this.workplace&&this.workplace.dispatcher.emit("addNode",r)}createCategory(){if(!this.staticFieldCreated){const r=ke.getAll();for(const[t,e]of r)this.createField(t,e);this.staticFieldCreated=!0}}}var _;class Ze extends A{constructor(){super();a(this,_,null);this.control=Ls,this.controlProperties={}}get iproperty(){return s(this,_)}main(){s(this,_)&&this.setValue(s(this,_).value)}render(){return this.args.iobject?(h(this,_,this.args.iobject),this.node("div",[this.template()],{class:{value:this.args.class||"",keys:[]}},[],"")):this.node("label",["Invalid property"],{},[],"")}template(){return""}updateValue(){s(this,_).value=value}setValue(t){}}_=new WeakMap;class Je extends Ze{constructor(){super()}template(){return this.node("input",[],{id:{value:"textbox",keys:[]},type:{value:"text",keys:[]},oninput:{value:this.updateValue,keys:[]},class:{value:"primary-input w-full h-full",keys:[]},placeholder:{value:"Value",keys:[]}},[],"")}setValue(r){const{textbox:t}=this.element;t.value=r}updateValue(){const{textbox:r}=this.element;this.iproperty.value=r.value}}class Vs extends Je{constructor(){super()}template(){return this.node("input",[],{id:{value:"textbox",keys:[]},type:{value:"number",keys:[]},oninput:{value:this.updateValue,keys:[]},class:{value:"primary-input w-full h-full",keys:[]},placeholder:{value:"Value",keys:[]}},[],"")}}const xe={[$.FLOAT]:Vs,[$.STRING]:Je};var E,yt,zt,Xt,qe,Zt,Ke;class We extends A{constructor(){super();a(this,yt);a(this,Xt);a(this,Zt);a(this,E,void 0)}main(){this.reset()}render(){return this.node("div",[this.node("div",[this.node("input",[],{id:{value:"propertyName",keys:[]},class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("select",[...Object.keys(xe).map(t=>this.node("option",[t],{value:{value:t,keys:[]}},[],""))],{id:{value:"propertyType",keys:[]},class:{value:"primary-select",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Xe},[],"")],{class:{value:"primary-btn",keys:[]},onclick:{value:d(this,Zt,Ke),keys:[]}},[],"")],{class:{value:"flex flex-row space-x-1",keys:[]}},[],""),this.node("div",["{properties}"],{class:{value:"flex flex-col space-y-1 mt-1",keys:[]}},["{properties}"],"")],{},[],"")}reset(){s(this,E)&&s(this,E).dispatcher.clearAll(),this.set("{properties}",this.node("label",["No Property Manager Found"],{class:{value:"text-xs",keys:[]}},[],""))}refresh(t){s(this,E)&&s(this,E).dispatcher.clearAll(),h(this,E,t),s(this,E).dispatcher.on("propertyAdded",()=>d(this,yt,zt).call(this)),s(this,E).dispatcher.on("propertyRemoved",()=>d(this,yt,zt).call(this)),d(this,yt,zt).call(this)}destroy(){s(this,E)&&s(this,E).dispatcher.clearAll(),super.destroy()}}E=new WeakMap,yt=new WeakSet,zt=function(){const{properties:t}=this.key;t("");for(const o in this.child){const i=this.child[o];i instanceof Ze&&i.destroy()}const e=s(this,E).properties;for(const[o,i]of e){const n=xe[i.type];n&&t(this.node("div",[this.node("label",[i.name],{class:{value:"text-xs font-semibold",keys:[]}},[],""),this.node("div",[this.component(n,[],{id:o,iobject:i,class:"w-full flex"},[],""),this.node("button",[this.component(C,[],{width:"12px",height:"12px",path:je},[],"")],{class:{value:"primary-btn px-2 pt-[6px]",keys:[]},onclick:{value:()=>{d(this,Xt,qe).call(this,o)},keys:[]}},[],"")],{class:{value:"w-full flex flex-row space-x-1",keys:[]}},[],"")],{class:{value:"flex flex-col",keys:[]}},[],""),"x++")}},Xt=new WeakSet,qe=function(t){if(!s(this,E)){console.error("Property manager not found");return}s(this,E).removeProperty(t)},Zt=new WeakSet,Ke=function(){if(!s(this,E)){console.error("Property manager not found");return}const{propertyName:t,propertyType:e}=this.element;s(this,E).addProperty(null,t.value,e.value),t.value=""};var L,tt,gt,Yt,Jt,Qe,Wt,_e,qt,ts;class Ds extends A{constructor(){super();a(this,gt);a(this,Jt);a(this,Wt);a(this,qt);a(this,L,null);a(this,tt,null)}main(t){h(this,tt,ve(this))}render(){return this.node("div",[this.node("div",[this.node("button",[this.component(C,[],{path:$e},[],"")],{onclick:{value:()=>this.changeTab("tabNode"),keys:[]},title:{value:"Node List",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Ts},[],"")],{onclick:{value:()=>this.changeTab("tabProperties"),keys:[]},title:{value:"Properties",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Hs},[],"")],{title:{value:"Run",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Ps},[],"")],{onclick:{value:()=>this.parent.debug(),keys:[]},title:{value:"Debug",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Us},[],"")],{onclick:{value:()=>this.parent.export(),keys:[]},title:{value:"Export",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Ms},[],"")],{onclick:{value:()=>this.parent.save(),keys:[]},title:{value:"Save",keys:[]}},[],"")],{class:{value:"side-menu",keys:[]}},[],""),this.node("div",[this.node("div",[this.node("div",[this.node("label",["Graphs Set"],{class:{value:"!text-sm !font-normal",keys:[]}},[],"")],{class:{value:"property text-2xl",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.node("div",[this.node("label",["Graphs:"],{},[],""),this.node("div",[this.node("div",[this.node("input",[],{class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]},id:{value:"graphName",keys:[]}},[],""),this.node("button",[this.component(C,[],{path:Xe},[],"")],{class:{value:"primary-btn",keys:[]},onclick:{value:d(this,Wt,_e),keys:[]}},[],"")],{class:{value:"flex flex-row space-x-1",keys:[]}},[],""),this.node("div",["{graphs}"],{class:{value:"space-y-1",keys:[]}},["{graphs}"],"")],{},[],"")],{class:{value:"property",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.node("div",[this.node("label",["Graphs Set Properties:"],{},[],""),this.node("div",[this.component(We,[],{id:"graphsetProperties"},[],"")],{},[],"")],{class:{value:"property",keys:[]}},[],"")],{id:{value:"tabProperties",keys:[]},class:{value:"property-tab",keys:[]}},[],""),this.node("div",[this.node("div",[this.node("label",["Nodes:"],{class:{value:"!text-sm !font-normal",keys:[]}},[],"")],{class:{value:"property text-2xl",keys:[]}},[],""),this.node("div",[],{class:{value:"seperator",keys:[]}},[],""),this.component(Cs,[],{id:"category",auto:"true"},[],"")],{id:{value:"tabNode",keys:[]},class:{value:"property-tab hidden",keys:[]}},[],"")],{id:{value:"tabs",keys:[]},class:{value:"property-container border-r border-zinc-700",keys:[]}},[],"")],{class:{value:"flex flex-row h-full",keys:[]}},[],"")}changeTab(t){const{tabs:e}=this.element;e.childNodes.forEach(i=>{i.classList.add("hidden")});const o=this.element[t];o&&o.classList.remove("hidden")}refreshGraphSet(t){s(this,L)&&s(this,L).destroy(),h(this,L,t),s(this,L).dispatcher.on("graphAdded",e=>d(this,gt,Yt).call(this)),s(this,L).dispatcher.on("graphRemoved",e=>d(this,gt,Yt).call(this)),this.child.graphsetProperties.refresh(s(this,L).propertyManager),d(this,gt,Yt).call(this)}destroy(){s(this,tt)&&s(this,tt).dispatcher.clear("openGraph"),s(this,L)&&(s(this,L).dispatcher.clear("graphAdded"),s(this,L).dispatcher.clear("graphRemoved")),super.destroy()}}L=new WeakMap,tt=new WeakMap,gt=new WeakSet,Yt=function(){const{graphs:t}=this.key;t("");const e=s(this,L).graphs;for(const[o,i]of e)t(this.node("div",[this.node("label",[i.custom.name],{class:{value:"w-full text-xs font-semibold",keys:[]}},[],""),this.node("button",[this.component(C,[],{width:"12px",height:"12px",path:je},[],"")],{class:{value:"primary-btn",keys:[]},onclick:{value:n=>{n.stopPropagation(),d(this,qt,ts).call(this,o)},keys:[]}},[],"")],{class:{value:"primary-input bg-opacity-50 flex flex-row items-center pr-1",keys:[]},onclick:{value:()=>d(this,Jt,Qe).call(this,o),keys:[]}},[],""),"x++")},Jt=new WeakSet,Qe=function(t){s(this,tt)&&s(this,tt).dispatcher.emit("openGraph",t)},Wt=new WeakSet,_e=function(){const{graphName:t}=this.element;if(!t||!t.value){alert("Please enter a name for the graph");return}s(this,L).addGraph(null,{nodes:{},links:[],properties:{},custom:{name:t.value||"no name"},inputs:{},outputs:{}}),t.value="",console.warn("Graph added")},qt=new WeakSet,ts=function(t){s(this,L).removeGraph(t),console.warn("Graph removed")};var N,kt,vt,ft,ct,Kt,es,Qt,ss,_t,os,Vt,Se;class Gs{constructor(r){a(this,Kt);a(this,Qt);a(this,_t);a(this,Vt);a(this,N,null);a(this,kt,null);a(this,vt,null);a(this,ft,null);a(this,ct,null);h(this,N,r),h(this,kt,d(this,Kt,es).bind(this)),h(this,vt,d(this,Qt,ss).bind(this)),h(this,ft,d(this,_t,os).bind(this))}register(){if(!s(this,N)){console.error("ZoomHandler: Invalid target element");return}s(this,N).addEventListener("mousewheel",s(this,kt)),s(this,N).addEventListener("touchstart",s(this,vt),{passive:!1}),s(this,N).addEventListener("touchmove",s(this,ft),{passive:!1})}unregister(){if(!s(this,N)){console.error("ZoomHandler: Invalid target element");return}s(this,N).removeEventListener("mousewheel",s(this,kt)),s(this,N).removeEventListener("touchstart",s(this,vt)),s(this,N).removeEventListener("touchmove",s(this,ft))}onZoom(){}}N=new WeakMap,kt=new WeakMap,vt=new WeakMap,ft=new WeakMap,ct=new WeakMap,Kt=new WeakSet,es=function(r){r.stopPropagation(),r.preventDefault();const t=s(this,N),e=t.getBoundingClientRect(),o=r.clientX-e.left,i=r.clientY-e.top,n=r.deltaY>0?-.05:.05,c=Math.min(Math.max(g.zoom+n,g.zoomMin),g.zoomMax),u=c/g.zoom,p=o-o*u,m=i-i*u;t.style.transform=`scale(${c})`,t.style.left=`${(parseFloat(t.style.left||0)||0)+p}px`,t.style.top=`${(parseFloat(t.style.top||0)||0)+m}px`,g.zoom=c,this.onZoom()},Qt=new WeakSet,ss=function(r){if(r.touches.length===2){r.preventDefault();const[t,e]=r.touches;h(this,ct,d(this,Vt,Se).call(this,t,e))}},_t=new WeakSet,os=function(r){if(r.touches.length===2){r.preventDefault();const[t,e]=r.touches,o=d(this,Vt,Se).call(this,t,e);if(s(this,ct)!==null){const i=(o-s(this,ct))/200,n=Math.min(Math.max(g.zoom+i,g.zoomMin),g.zoomMax),c=s(this,N).getBoundingClientRect(),u=(t.clientX+e.clientX)/2-c.left,p=(t.clientY+e.clientY)/2-c.top,m=n/g.zoom,y=u-u*m,k=p-p*m;s(this,N).style.transform=`scale(${n})`,s(this,N).style.left=`${(parseFloat(s(this,N).style.left||0)||0)+y}px`,s(this,N).style.top=`${(parseFloat(s(this,N).style.top||0)||0)+k}px`,g.zoom=n,this.onZoom()}h(this,ct,o)}},Vt=new WeakSet,Se=function(r,t){const e=t.clientX-r.clientX,o=t.clientY-r.clientY;return Math.sqrt(e*e+o*o)};var Z,Y,J,wt,xt,ut,ht,Dt,Ne,te,is,ee,ns;class rs{constructor(r,t,e){a(this,Dt);a(this,te);a(this,ee);a(this,Z,null);a(this,Y,null);a(this,J,null);a(this,wt,null);a(this,xt,null);a(this,ut,null);a(this,ht,null);h(this,Z,r),h(this,Y,t),h(this,J,e),h(this,wt,d(this,ee,ns).bind(this)),h(this,xt,d(this,te,is).bind(this)),this.gridSize=10,this.isFrame=!1}register(){if(!s(this,Y)||!s(this,Z)||!s(this,J)){console.error("DragHandler: Invalid target element");return}d(this,Dt,Ne).call(this),s(this,Y).addEventListener("mousedown",s(this,wt)),s(this,Y).addEventListener("touchstart",s(this,xt))}unregister(){if(!s(this,Y)||!s(this,Z)||!s(this,J)){console.error("DragHandler: Invalid target element");return}d(this,Dt,Ne).call(this),s(this,Y).removeEventListener("mousedown",s(this,wt)),s(this,Y).removeEventListener("touchstart",s(this,xt))}lastBound(){return{target:s(this,ut),parent:s(this,ht)}}onDragEnd(){}}Z=new WeakMap,Y=new WeakMap,J=new WeakMap,wt=new WeakMap,xt=new WeakMap,ut=new WeakMap,ht=new WeakMap,Dt=new WeakSet,Ne=function(){h(this,ut,s(this,Z).getBoundingClientRect()),h(this,ht,s(this,J).getBoundingClientRect())},te=new WeakSet,is=function(r){r.stopPropagation(),r.preventDefault();const t=s(this,Z),e=s(this,J),o=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=r.touches[0],c=n.clientX-i.left,u=n.clientY-i.top,p=y=>{const k=y.touches[0];let P=i.width,U=i.height,w=(k.clientX-o.left-c)/(this.isFrame?1:g.zoom),H=(k.clientY-o.top-u)/(this.isFrame?1:g.zoom),j=Math.round(w/this.gridSize)*this.gridSize,Lt=Math.round(H/this.gridSize)*this.gridSize;this.isFrame||(j=Math.max(0,Math.min(j,g.size.width-P/g.zoom)),Lt=Math.max(0,Math.min(Lt,g.size.height-U/g.zoom))),t.style.left=j+"px",t.style.top=Lt+"px"},m=y=>{y.stopPropagation(),y.preventDefault(),window.removeEventListener("touchmove",p),window.removeEventListener("touchend",m),h(this,ut,t.getBoundingClientRect()),h(this,ht,e.getBoundingClientRect()),this.onDragEnd()};window.addEventListener("touchmove",p),window.addEventListener("touchend",m)},ee=new WeakSet,ns=function(r){r.stopPropagation(),r.preventDefault();const t=s(this,Z),e=s(this,J),o=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=r.clientX-i.left,c=r.clientY-i.top,u=m=>{m.stopPropagation(),m.preventDefault();let y=i.width,k=i.height,P=(m.clientX-o.left-n)/(this.isFrame?1:g.zoom),U=(m.clientY-o.top-c)/(this.isFrame?1:g.zoom),w=Math.round(P/this.gridSize)*this.gridSize,H=Math.round(U/this.gridSize)*this.gridSize;this.isFrame||(w=Math.max(0,Math.min(w,g.size.width-y/g.zoom)),H=Math.max(0,Math.min(H,g.size.height-k/g.zoom))),t.style.left=w+"px",t.style.top=H+"px"},p=m=>{m.stopPropagation(),m.preventDefault(),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",p),h(this,ut,t.getBoundingClientRect()),h(this,ht,e.getBoundingClientRect()),this.onDragEnd()};window.addEventListener("mousemove",u),window.addEventListener("mouseup",p)};var b,O,St,W,se,as,oe,ls,re,cs,ie,us,Gt,be;class Os extends A{constructor(){super();a(this,se);a(this,oe);a(this,re);a(this,ie);a(this,Gt);a(this,b,null);a(this,O,null);a(this,St,[]);a(this,W,null)}main(){if(!s(this,b)){console.error("Invalid socket");return}h(this,O,ve(this))}removeButton(){return s(this,b).isRuntime?this.node("button",["×"],{class:{value:"text-xs font-semibold text-rose-500 mr-1",keys:[]},onclick:{value:d(this,se,as),keys:[]}},[],""):""}render(){if(!this.args.iobject)return this.node("label",["Invalid socket"],{},[],"");h(this,b,this.args.iobject);const t=s(this,b).meta,e=s(this,b).name||t.displayName,o=t.displayColor||"gray",i=s(this,b).type==x.TYPES.OUTPUT;return this.node("div",[this.node("span",[...this.removeButton()],{},[],""),this.node("label",[e],{},[],""),this.node("button",[],{id:{value:"btn",keys:[]},onclick:{value:d(this,oe,ls),keys:[]},ontouchstart:{value:d(this,Gt,be),keys:[]},onmousedown:{value:d(this,Gt,be),keys:[]},style:{value:`background-color: ${o};`,keys:[]},class:{value:`pin ${i?"right":"left"}`,keys:[]}},[],"")],{class:{value:"pin-holder",keys:[]},onmouseover:{value:d(this,re,cs),keys:[]},onmouseleave:{value:d(this,ie,us),keys:[]},socketuuid:{value:s(this,b).uuid,keys:[]},nodeuuid:{value:s(this,b).outer.uuid,keys:[]}},[],"")}clearLinks(){s(this,St).forEach(t=>{t.remove()}),h(this,St,[])}get isocket(){return s(this,b)}getSocketElement(){return this.element.btn}addLink(t){s(this,St).push(t)}destroy(){this.clearLinks(),super.destroy()}}b=new WeakMap,O=new WeakMap,St=new WeakMap,W=new WeakMap,se=new WeakSet,as=function(){s(this,b).isRuntime&&(s(this,O).dispatcher.emit("clearAllSocketLinks",this),this.parent.removeSocket(s(this,b)))},oe=new WeakSet,ls=function(){if(s(this,b).type!=x.TYPES.INPUT||!s(this,O)){console.error("Invalid socket or workspace");return}s(this,O).dispatcher.emit("clearAllSocketLinks",this)},re=new WeakSet,cs=function(){s(this,b).type==x.TYPES.INPUT&&s(this,O).dispatcher.emit("createTargetSocket",this)},ie=new WeakSet,us=function(){s(this,b).type==x.TYPES.INPUT&&s(this,O).dispatcher.emit("clearTargetSocket",this)},Gt=new WeakSet,be=function(t){if(s(this,b).type!==x.TYPES.OUTPUT||!s(this,O))return;t.stopPropagation(),t.preventDefault();const e=s(this,O).dispatcher,o=this,i=this.root,n=this.getSocketElement();if(t.type==="touchstart"&&t.touches.length===1&&h(this,W,{x:t.touches[0].clientX,y:t.touches[0].clientY}),i){let c=function(y){y.stopPropagation(),y.preventDefault(),e.emit("updateSocketHelper",{socketId:o.id,socketElement:n,x:y.clientX,y:y.clientY})},u=function(y){if(y.touches.length===1){const k=y.touches[0];k.clientX-s(o,W).x,k.clientY-s(o,W).y,e.emit("updateSocketHelper",{socketId:o.id,socketElement:n,x:k.clientX,y:k.clientY}),h(o,W,{x:k.clientX,y:k.clientY})}y.stopPropagation(),y.preventDefault()},p=function(y){y.stopPropagation(),y.preventDefault(),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",p),e.emit("clearSocketHelper",o.id),e.emit("clearSourceSocket",o)},m=function(y){y.stopPropagation(),y.preventDefault(),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",m),e.emit("clearSocketHelper",o.id),e.emit("clearSourceSocket",o);const k=s(o,W).x,P=s(o,W).y;document.elementsFromPoint(k,P).forEach(w=>{if(w.hasAttribute("socketuuid")&&w.hasAttribute("nodeuuid")){console.log(w.getAttribute("socketuuid"),w.getAttribute("nodeuuid"));return}})};e.emit("createSocketHelper",o),e.emit("createSourceSocket",o),t.type==="mousedown"?(window.addEventListener("mousemove",c),window.addEventListener("mouseup",p)):t.type==="touchstart"&&(window.addEventListener("touchmove",u),window.addEventListener("touchend",m))}};var f,et,ne,hs,Nt,Ft;class As extends A{constructor(){super();a(this,ne);a(this,Nt);a(this,f,null);a(this,et,null)}main(t={}){s(this,f)&&(h(this,et,new rs(this.root,this.root,this.parent.root)),s(this,et).onDragEnd=()=>{const e=this.root.style.left.replace("px",""),o=this.root.style.top.replace("px","");s(this,f).custom.x=Math.round(e)||5,s(this,f).custom.y=Math.round(o)||5},s(this,et).register(),d(this,ne,hs).call(this),this.renderProperties())}render(){if(!this.args.iobject)return this.node("label",["Invalid node"],{},[],"");h(this,f,this.args.iobject),s(this,f).custom.x==null&&(s(this,f).custom.x=5),s(this,f).custom.y==null&&(s(this,f).custom.y=5);const t=Math.round(s(this,f).custom.x),e=Math.round(s(this,f).custom.y),o=s(this,f).meta,i=s(this,f).name||o.displayName||"Node",n=o.canCache?"cache":"non-cache",c=s(this,f).isEntry?this.node("button",["(run)"],{onclick:{value:()=>{s(this,f).execute()},keys:[]}},[],""):"";return this.node("div",[this.node("div",[this.node("div",[this.node("label",[i],{id:{value:"handle",keys:[]}},[],""),c],{class:{value:`${n}`,keys:[]}},[],""),this.node("button",["×"],{class:{value:"node-close",keys:[]},onclick:{value:this.removeNode,keys:[]}},[],"")],{id:{value:"header",keys:[]},class:{value:"node-title",keys:[]}},[],""),this.node("div",[this.node("div",["{inputs}"],{class:{value:"input",keys:[]}},["{inputs}"],""),this.node("div",["{outputs}"],{class:{value:"output",keys:[]}},["{outputs}"],"")],{id:{value:"socket",keys:[]},class:{value:"node-socket",keys:[]}},[],""),this.node("div",["{properties}"],{id:{value:"values",keys:[]},class:{value:"node-property",keys:[]},onmousedown:{value:u=>u.stopPropagation(),keys:[]}},["{properties}"],"")],{class:{value:`node ${n}`,keys:[]},style:{value:`top: ${e}px; left: ${t}px; min-width: 100px;`,keys:[]}},[],"")}renderProperties(){const{properties:t}=this.key,e=s(this,f).propertyManager.properties;t("");for(const[o,i]of e){if(!i)continue;const n=i.type;if(!n)continue;const c=xe[n];c&&t(this.component(c,[],{iobject:i},[],""),"x++")}}addOutputSocket(t){const o=s(this,f).addOutput(t,"out",bt,!0),{outputs:i}=this.key;d(this,Nt,Ft).call(this,i,o)}removeSocket(t){const e=t.uuid;t.type==x.TYPES.INPUT?s(this,f).removeInput(e):s(this,f).removeOutput(e),this.child[e].destroy()}destroy(){if(s(this,et)){const t=this.root.style.left.replace("px",""),e=this.root.style.top.replace("px","");s(this,f).custom.x=Math.round(t)||5,s(this,f).custom.y=Math.round(e)||5,s(this,et).unregister()}super.destroy()}}f=new WeakMap,et=new WeakMap,ne=new WeakSet,hs=function(){const{inputs:t,outputs:e}=this.key,o=s(this,f).inputs,i=s(this,f).outputs;t("");for(const n in o)d(this,Nt,Ft).call(this,t,o[n]);e("");for(const n in i)d(this,Nt,Ft).call(this,e,i[n])},Nt=new WeakSet,Ft=function(t,e){t(this.component(Os,[],{id:e.uuid,iobject:e},[],""),"x++")};var ae,ds;class Rs{constructor({source:r,target:t,graph:e}={}){a(this,ae);this.uuid=crypto.randomUUID(),this.graph=e,this.source=r,this.target=t,this.line=null,this.fOnMouseDown=this.onMouseDown.bind(this),this.fOnTouchStart=this.onTouchStart.bind(this)}remove(){this.line.remove()}getColor(){let r="#3b82f6";const t=this.source.isocket;if(!t)return r;const e=t.meta;return!e||!e.displayColor?r:e.displayColor}create(){const{source:r,target:t,graph:e,fOnMouseDown:o,fOnTouchStart:i}=this;r.addLink(this),t.addLink(this);const n=g.zoom||1,{x:c,y:u}=e.root.getBoundingClientRect(),p=r.getSocketElement().getBoundingClientRect(),m=(p.left-c+p.width/2)/n,y=(p.top-u+p.height/2)/n,k=t.getSocketElement().getBoundingClientRect(),P=(k.left-c+k.width/2)/n,U=(k.top-u+k.height/2)/n;return r.parent.root.addEventListener("mousedown",o),t.parent.root.addEventListener("mousedown",o),r.parent.root.addEventListener("touchstart",i),t.parent.root.addEventListener("touchstart",i),this.line=d(this,ae,ds).call(this,m,y,P,U),this.line}onMouseDown(r){const{source:t,target:e,graph:o,line:i}=this,n=g.zoom||1,c=p=>{const{x:m,y}=o.root.getBoundingClientRect(),k=t.getSocketElement().getBoundingClientRect(),P=(k.left-m+k.width/2)/n,U=(k.top-y+k.height/2)/n,w=e.getSocketElement().getBoundingClientRect(),H=(w.left-m+w.width/2)/n,j=(w.top-y+w.height/2)/n;i.setAttributeNS(null,"x1",P),i.setAttributeNS(null,"y1",U),i.setAttributeNS(null,"x2",H),i.setAttributeNS(null,"y2",j)},u=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",u)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",u)}onTouchStart(r){const{source:t,target:e,graph:o,line:i}=this,n=g.zoom||1,c=p=>{const{x:m,y}=o.root.getBoundingClientRect(),k=t.getSocketElement().getBoundingClientRect(),P=(k.left-m+k.width/2)/n,U=(k.top-y+k.height/2)/n,w=e.getSocketElement().getBoundingClientRect(),H=(w.left-m+w.width/2)/n,j=(w.top-y+w.height/2)/n;i.setAttributeNS(null,"x1",P),i.setAttributeNS(null,"y1",U),i.setAttributeNS(null,"x2",H),i.setAttributeNS(null,"y2",j)},u=()=>{window.removeEventListener("touchmove",c),window.removeEventListener("touchend",u)};window.addEventListener("touchmove",c),window.addEventListener("touchend",u)}}ae=new WeakSet,ds=function(r,t,e,o){const i=this.getColor(),n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttributeNS(null,"x1",r),n.setAttributeNS(null,"y1",t),n.setAttributeNS(null,"x2",e),n.setAttributeNS(null,"y2",o),n.setAttributeNS(null,"style",`stroke:${i};stroke-width:2`),n.setAttributeNS(null,"class","socket-link"),n};var v,st,F,q,Ot,Ee,le,ps,At,Le,ce,ms,Rt,Ie,ue,ys,he,gs,de,ks,pe,vs,me,fs;class zs extends A{constructor(){super();a(this,Ot);a(this,le);a(this,At);a(this,ce);a(this,Rt);a(this,ue);a(this,he);a(this,de);a(this,pe);a(this,me);a(this,v,null);a(this,st,null);a(this,F,null);a(this,q,null);this.sourceSocket=null,this.targetSocket=null,this.helperLinks=new Map}main(t={}){s(this,v)&&(h(this,q,ve(this)),d(this,ue,ys).call(this),d(this,he,gs).call(this),d(this,de,ks).call(this),d(this,le,ps).call(this),d(this,ce,ms).call(this))}render(){if(!this.args.iobject)return this.node("label",["Invalid graph"],{},[],"");h(this,v,this.args.iobject),s(this,v).custom.x==null&&(s(this,v).custom.x=0),s(this,v).custom.y==null&&(s(this,v).custom.y=0),s(this,v).custom.z==null&&(s(this,v).custom.z=1);const t=Math.round(s(this,v).custom.x),e=Math.round(s(this,v).custom.y),o=g.zoom=parseFloat(s(this,v).custom.z);return this.node("div",[this.node("div",[d(this,Ot,Ee).call(this,"backGraph"),this.node("div",["{nodes}"],{},["{nodes}"],""),d(this,Ot,Ee).call(this,"topGraph")],{id:{value:"frame",keys:[]},class:{value:"frame absolute",keys:[]}},[],"")],{class:{value:"absolute",keys:[]},style:{value:`left: ${t}px; top: ${e}px; transform: scale(${o});`,keys:[]}},[],"")}destroy(){if(s(this,q)){const t=s(this,q).dispatcher;t.clear("addNode"),t.clear("createSocketHelper"),t.clear("updateSocketHelper"),t.clear("clearSocketHelper"),t.clear("createSourceSocket"),t.clear("clearSourceSocket"),t.clear("createTargetSocket"),t.clear("clearTargetSocket"),t.clear("clearAllInputLinks")}if(s(this,v)&&(s(this,v).dispatcher.clear("nodeAdded"),s(this,v).dispatcher.clear("socketsLinked")),s(this,st)&&s(this,st).unregister(),s(this,F)){const t=this.root.style.left.replace("px",""),e=this.root.style.top.replace("px","");s(this,v).custom.x=Math.round(t),s(this,v).custom.y=Math.round(e),s(this,v).custom.z=parseFloat(g.zoom).toFixed(4),s(this,F).unregister()}super.destroy()}}v=new WeakMap,st=new WeakMap,F=new WeakMap,q=new WeakMap,Ot=new WeakSet,Ee=function(t){return this.node("svg",[this.node("defs",[this.node("linearGradient",[this.node("stop",[],{offset:{value:"0%",keys:[]},"stop-color":{value:"white",keys:[]}},[],"http://www.w3.org/2000/svg"),this.node("stop",[],{offset:{value:"100%",keys:[]},"stop-color":{value:"rgba(255,255,255,0.1)",keys:[]}},[],"http://www.w3.org/2000/svg")],{id:{value:"myGradient",keys:[]},x1:{value:"0%",keys:[]},y1:{value:"0%",keys:[]},x2:{value:"100%",keys:[]},y2:{value:"0%",keys:[]}},[],"http://www.w3.org/2000/svg")],{},[],"http://www.w3.org/2000/svg")],{width:{value:g.size.width,keys:[]},height:{value:g.size.height,keys:[]},id:{value:t,keys:[]},class:{value:"absolute select-none pointer-events-none top-0 left-0",keys:[]}},[],"http://www.w3.org/2000/svg")},le=new WeakSet,ps=function(){this.set("{nodes}","");const t=s(this,v).nodes;for(const[e,o]of t)d(this,At,Le).call(this,o)},At=new WeakSet,Le=function(t){this.set("{nodes}++",this.component(As,[],{id:t.uuid,iobject:t},[],""))},ce=new WeakSet,ms=function(){queueMicrotask(()=>{const t=s(this,v).links;for(const e of t)d(this,Rt,Ie).call(this,e)})},Rt=new WeakSet,Ie=function(t={}){const e=this.child[t.sourceNode],o=this.child[t.targetNode];if(!e||!o){console.error("Invalid source or target nodes");return}const i=e.child[t.sourceSocket],n=o.child[t.targetSocket];if(!i||!n){console.error("Invalid source or target socket");return}const u=new Rs({source:i,target:n,graph:this}).create();this.element.backGraph.append(u)},ue=new WeakSet,ys=function(){const{frame:t}=this.element;t.style.width=g.size.width+"px",t.style.height=g.size.height+"px"},he=new WeakSet,gs=function(){h(this,st,new Gs(this.root)),s(this,st).onZoom=()=>{s(this,v).custom.z=g.zoom},s(this,st).register(),h(this,F,new rs(this.root,this.parent.element.viewport,this.parent.element.viewport)),s(this,F).isFrame=!0,s(this,F).gridSize=1,s(this,F).onDragEnd=()=>{const t=this.root.style.left.replace("px",""),e=this.root.style.top.replace("px","");s(this,v).custom.x=Math.round(t),s(this,v).custom.y=Math.round(e)},s(this,F).register()},de=new WeakSet,ks=function(){if(!s(this,q)){console.error("Invalid workplace");return}d(this,pe,vs).call(this),d(this,me,fs).call(this)},pe=new WeakSet,vs=function(){s(this,q).dispatcher.on("addNode",t=>{s(this,v).addNode(null,{class:t})}),s(this,v).dispatcher.on("nodeAdded",t=>{console.warn(`UIGraph: Node ${t.uuid} added`),d(this,At,Le).call(this,t)})},me=new WeakSet,fs=function(){const{topGraph:t}=this.element,e=s(this,q).dispatcher;e.on("createSocketHelper",o=>{const i=o.id;let n="#3b82f6";const c=o.isocket;if(c){const p=c.meta;p&&(n=p.displayColor)}const u=this.node("line",[],{x1:{value:0,keys:[]},y1:{value:0,keys:[]},x2:{value:0,keys:[]},y2:{value:0,keys:[]},style:{value:`stroke:${n};stroke-width:2;`,keys:[]},class:{value:"socket-link",keys:[]}},[],"http://www.w3.org/2000/svg");t.append(u),this.helperLinks.set(i,u)}),e.on("updateSocketHelper",({socketId:o,socketElement:i,x:n,y:c})=>{const u=this.helperLinks.get(o);if(u){const p=g.zoom,{x:m,y}=this.root.getBoundingClientRect(),{x:k,y:P,width:U,height:w}=i.getBoundingClientRect(),H=(k-m+U/2)/p,j=(P-y+w/2)/p,Lt=(n-m)/p,xs=(c-y)/p;u.setAttributeNS(null,"x1",H),u.setAttributeNS(null,"y1",j),u.setAttributeNS(null,"x2",Lt),u.setAttributeNS(null,"y2",xs)}}),e.on("clearSocketHelper",o=>{const i=this.helperLinks.get(o);i&&(i.remove(),this.helperLinks.delete(o))}),e.on("createSourceSocket",o=>{this.sourceSocket=o,console.warn(`Source socket set to ${o.id}`)}),e.on("clearSourceSocket",o=>{const i=this.sourceSocket,n=this.targetSocket;this.sourceSocket=null,this.targetSocket=null,n&&i&&s(this,v).linkSockets(i.isocket,n.isocket)}),e.on("clearAllSocketLinks",o=>{if(!o)return;const i=o.isocket;if(!i)return;if(!s(this,v).clearAllSocketLinks(i)){console.error("Failed to clear socket");return}o.clearLinks(),console.warn("Cleared all sockets links")}),s(this,v).dispatcher.on("socketsLinked",({sourceNode:o,sourceSocket:i,targetNode:n,targetSocket:c})=>{d(this,Rt,Ie).call(this,{sourceNode:o,sourceSocket:i,targetNode:n,targetSocket:c})}),e.on("createTargetSocket",o=>{this.sourceSocket&&(this.targetSocket=o,console.warn(`Target socket set to ${o.id}`))}),e.on("clearTargetSocket",o=>{this.sourceSocket&&(this.targetSocket=null,console.warn("Target socket cleared"))})};var Te;class Ys extends A{constructor(){super();a(this,Te,null)}main(t){}render(){return this.node("div",[this.node("div",[this.node("label",["Graphs Properties:"],{class:{value:"mb-2",keys:[]}},[],""),this.node("div",[this.component(We,[],{id:"graphProperties"},[],"")],{},[],"")],{class:{value:"property",keys:[]}},[],"")],{class:{value:"property-container border-l border-zinc-700",keys:[]}},[],"")}refresh(t){if(!t){console.error("No graph provided");return}this.child.graphProperties.refresh(t.propertyManager)}destroy(){super.destroy()}}Te=new WeakMap;var B,K;class Fs extends Ue{constructor(){super();a(this,B,null);a(this,K,null);this.activeGraphUUID=null}main(t){this.load()}async load(){const t=this.args.path;let e=await Es(t);if(!e){alert("Failed to load file");return}e=JSON.parse(e);let o=Object.keys(e)[0];(!o||o.length<5)&&(o=crypto.randomUUID()),this.createEngine(),this.createGraphSet(o,e[o]);const{graph:i}=this.key;i(this.node("label",["No graph selected"],{class:{value:"message",keys:[]}},[],"")),this.dispatcher.on("openGraph",n=>this.openGraph(n))}render(){return this.node("div",[this.component(Ds,[],{id:"navigator",workspace:this},[],""),this.node("div",["{graph}"],{id:{value:"viewport",keys:[]},class:{value:"viewport",keys:[]}},["{graph}"],""),this.component(Ys,[],{id:"graphProperty",workspace:this},[],"")],{class:{value:"project-workspace",keys:[]}},[],"")}export(){const t=s(this,K).export(),e=JSON.stringify(t);console.log(t),console.log(e);const o=new Blob([e],{type:"text/plain"}),i=document.createElement("a"),n=URL.createObjectURL(o);i.href=n,i.download=(s(this,K).custom.name||"graphset")+".ren",i.click(),URL.revokeObjectURL(n)}async save(){const t=s(this,K).export(),e=this.args.path;await He(e,JSON.stringify(t)),alert("Saved")}debug(){console.log(s(this,B))}getViewport(){return this.element.viewport}createEngine(){h(this,B,new Be),console.warn("IEngine added")}destroyEngine(){s(this,B).destroy(),h(this,B,null),console.warn("IEngine destroyed")}createGraphSet(t,e={properties:{},graphs:{},custom:{}}){h(this,K,s(this,B).addGraphSet(t,e)),this.child.navigator.refreshGraphSet(s(this,K)),console.warn("Graph Set added")}openGraph(t){try{const{graph:e}=this.key;if(t||e(this.node("label",["No graph selected"],{class:{value:"text-zinc-500 text-xs font-semibold ml-2",keys:[]}},[],"")),this.activeGraphUUID===t){console.warn("Graph already open");return}e(""),this.child.graph&&this.child.graph.destroy();const o=s(this,K).getGraph(t);if(!o)throw new Error(`Graph ${t} not found`);this.activeGraphUUID=t,this.child.graphProperty.refresh(o),e(this.component(zs,[],{iobject:o,id:"graph"},[],"")),console.warn("Graph opened")}catch(e){console.error(e||"Error opening graph")}}destroy(){s(this,B)&&s(this,B).destroy(),super.destroy()}}B=new WeakMap,K=new WeakMap;var ye,ws;class Bs extends A{constructor(){super();a(this,ye)}main(t){}render(){return this.node("div",[this.node("div",[this.node("label",["New Graph Set:"],{class:{value:"text-zinc-400 text-2xl font-semibold",keys:[]}},[],""),this.node("input",[],{type:{value:"text",keys:[]},id:{value:"fileName",keys:[]},class:{value:"primary-input w-full",keys:[]},placeholder:{value:"Name",keys:[]}},[],""),this.node("div",[this.node("button",["Create"],{class:{value:"primary-btn",keys:[]},onclick:{value:d(this,ye,ws),keys:[]}},[],""),this.node("button",["Cancel"],{class:{value:"primary-btn",keys:[]},onclick:{value:this.destroy,keys:[]}},[],"")],{class:{value:"space-x-1",keys:[]}},[],"")],{class:{value:"bg-zinc-800 p-10 w-full space-y-1",keys:[]}},[],"")],{class:{value:"w-full h-full absolute bg-zinc-900 bg-opacity-90 top-0 left-0 z-30 flex items-center",keys:[]}},[],"")}destroy(){super.destroy()}}ye=new WeakSet,ws=async function(){const{fileName:t}=this.element,e=(t.value.trim()||"untitled")+".ren";await He(e,"{}"),Bt.emit("file-written"),this.destroy()};function Xs(){Ce.set(".ren",Fs),Bt.emit("add-menu","ren-menu","Ren",{New:{"Graph Set":async()=>{Bt.emit("add-overlay",Bs)}}}),console.warn("registered")}function Zs(){Ce.delete(".ren"),Bt.emit("remove-menu","ren-menu"),console.log("unregistered")}export{Xs as register,Zs as unregister};
